# Регламент экспертизы исходного кода

| | |
|---|---|
| **Продукт** | [ЗАПОЛНИТЬ: наименование СЗИ] |
| **Версия документа** | 1.0 |
| **Дата** | [ЗАПОЛНИТЬ: дата утверждения] |
| **Статус** | Проект |
| **Утверждено** | [ЗАПОЛНИТЬ: должность, ФИО руководителя] |
| **Процесс ГОСТ Р 56939-2024** | 5.9 — Экспертиза исходного кода |

---

## Содержание

1. [Общие сведения](#1-общие-сведения)
2. [Область применения](#2-область-применения)
3. [Виды экспертизы кода](#3-виды-экспертизы-кода)
4. [Роли и ответственность](#4-роли-и-ответственность)
5. [Процедура проведения экспертизы](#5-процедура-проведения-экспертизы)
6. [Чеклист безопасности при экспертизе](#6-чеклист-безопасности-при-экспертизе)
7. [Выявление ненадёжных участков кода](#7-выявление-ненадёжных-участков-кода)
8. [Инструменты автоматизации](#8-инструменты-автоматизации)
9. [Метрики и контроль качества](#9-метрики-и-контроль-качества)
10. [Реестр результатов экспертизы](#10-реестр-результатов-экспертизы)
11. [История изменений](#11-история-изменений)

---

## 1. Общие сведения

### 1.1. Назначение документа

Настоящий Регламент определяет порядок проведения экспертизы (code review) исходного кода продукта [ЗАПОЛНИТЬ: наименование СЗИ], включая:

- Виды и условия проведения экспертизы исходного кода.
- Роли участников, их обязанности и квалификационные требования.
- Процедуру проведения экспертизы — от инициирования до принятия решения.
- Чеклисты проверки с фокусом на безопасность.
- Критерии выявления ненадёжных (потенциально уязвимых) участков кода.
- Порядок использования средств автоматизации при экспертизе.
- Метрики качества процесса экспертизы.
- Порядок документирования и хранения результатов экспертизы.

Регламент разработан в соответствии с требованиями ГОСТ Р 56939-2024, п. 5.9 и п. 5.9.2, которые устанавливают необходимость:

- Разработки регламента экспертизы кода.
- Проведения code review с фокусом на безопасность с использованием автоматизации.
- Выявления ненадёжных (потенциально уязвимых) участков кода.
- Документирования результатов экспертизы.

### 1.2. Нормативные ссылки

| Документ | Описание |
|----------|----------|
| ГОСТ Р 56939-2024, п. 5.9 | Экспертиза исходного кода — основной процесс |
| ГОСТ Р 56939-2024, п. 5.9.2 | Требования к процессу экспертизы исходного кода |
| ГОСТ Р 56939-2024, п. 5.8 | Формирование и поддержание правил кодирования — база для проверки при ревью |
| ГОСТ Р 56939-2024, п. 5.10 | Статический анализ ПО — результаты SAST дополняют экспертизу |
| ГОСТ Р 56939-2024, п. 5.11 | Динамический анализ ПО — результаты DAST могут инициировать целевое ревью |
| ГОСТ Р 56939-2024, п. 5.5 | Управление недостатками — замечания ревью обрабатываются как недостатки |
| OWASP Code Review Guide | Руководство по ревью кода с фокусом на безопасность |
| CWE/SANS Top 25 | Наиболее опасные ошибки в ПО — ориентир при проверке безопасности |
| ГОСТ Р 71207-2024 | Статический анализ ПО. Общие требования |

### 1.3. Связь с другими документами комплекта РБПО

Настоящий Регламент является частью комплекта документов РБПО и связан со следующими документами:

| Документ | Связь |
|----------|-------|
| 02 — Стандарт кодирования | Экспертиза проверяет соответствие кода правилам кодирования (п. 5.8). Стандарт кодирования определяет критерии, по которым рецензент оценивает стиль, структуру и безопасность кода |
| 04 — Регламент управления недостатками | Замечания, выявленные при экспертизе, классифицируемые как дефекты или уязвимости, регистрируются и обрабатываются по процессу 5.5 |
| 05 — Спецификация требований безопасности | Экспертиза верифицирует корректность реализации требований безопасности в коде. Рецензент проверяет, что изменения не нарушают установленные требования |
| 09 — Регламент статического анализа | Результаты SAST (п. 5.10) дополняют ручную экспертизу. Автоматический статический анализ выполняется до или параллельно с экспертизой; его результаты доступны рецензенту |
| 10 — Регламент динамического анализа | Результаты DAST (п. 5.11) могут инициировать целевую экспертизу участков кода, в которых обнаружены уязвимости при динамическом тестировании |

---

## 2. Область применения

### 2.1. Код, подлежащий экспертизе

Экспертизе подлежит весь исходный код продукта [ЗАПОЛНИТЬ: наименование СЗИ], включая:

- Собственный код приложения (backend, frontend, middleware).
- Конфигурационные файлы, влияющие на безопасность (Docker, CI/CD pipelines, Kubernetes manifests).
- Инфраструктура как код (IaC) — Terraform, Ansible, Helm charts.
- Скрипты сборки, развёртывания и миграции данных.
- Тестовый код (unit-тесты, интеграционные тесты, security-тесты).

### 2.2. Исключения

Из обязательной экспертизы могут быть исключены (с обоснованием):

- Автоматически сгенерированный код (при условии экспертизы генератора).
- Импортированные зависимости (анализируются в рамках SCA, процесс 5.16).
- Документация и комментарии (если не содержат конфигурационных данных).
- Временные ветки эксперимента, не предназначенные для слияния.

### 2.3. Этапы жизненного цикла

Экспертиза исходного кода проводится на следующих этапах:

| Этап | Описание | Обязательность |
|------|----------|----------------|
| Разработка новой функциональности | Все merge/pull requests в основные ветки | Обязательно |
| Исправление дефектов | Merge request с исправлением | Обязательно |
| Исправление уязвимостей | Merge request с исправлением уязвимости | Обязательно (с security-рецензентом) |
| Рефакторинг | Изменения, затрагивающие архитектуру или безопасность | Обязательно |
| Hotfix | Экстренное исправление критической проблемы | Обязательно (допускается post-commit review) |
| Обновление зависимостей | Обновление сторонних библиотек | Обязательно |

---

## 3. Виды экспертизы кода

### 3.1. Классификация видов экспертизы

| Вид экспертизы | Когда проводится | Кто проводит | Глубина анализа |
|----------------|------------------|--------------|-----------------|
| **Обязательный ревью** | Каждый merge/pull request в защищённую ветку | Минимум [ЗАПОЛНИТЬ: 1–2] рецензент(а) из команды | Полная проверка по чеклисту: логика, стиль, безопасность, тесты |
| **Security-focused ревью** | Изменения в security-critical компонентах, исправление уязвимостей | Security-рецензент (обязательно) + рецензент из команды | Углублённый анализ безопасности: модель угроз, атаки, CWE, криптография |
| **Архитектурный ревью** | Крупные изменения архитектуры, новые модули, изменение API-контрактов | Архитектор / техлид + рецензент из команды | Оценка архитектурных решений, масштабируемости, безопасности межкомпонентного взаимодействия |
| **Экспресс-ревью** | Минимальные изменения (тексты, конфигурация, документация) | Один рецензент из команды | Проверка корректности изменения, отсутствия побочных эффектов |

### 3.2. Критерии выбора вида экспертизы

- **Security-focused ревью** обязателен при изменениях в следующих областях:
  - Аутентификация и авторизация.
  - Криптография и управление ключами/секретами.
  - Обработка пользовательского ввода и валидация данных.
  - Сетевое взаимодействие и API endpoints.
  - Управление сессиями.
  - Файлы, указанные в [ЗАПОЛНИТЬ: CODEOWNERS / security-critical paths].

- **Архитектурный ревью** обязателен при:
  - Добавлении нового сервиса/модуля.
  - Изменении публичного API или межсервисного взаимодействия.
  - Изменении модели данных (схемы БД, форматов сообщений).
  - Добавлении новой критичной зависимости.

---

## 4. Роли и ответственность

### 4.1. Участники процесса экспертизы

| Роль | Обязанности | Квалификационные требования |
|------|-------------|----------------------------|
| **Автор (Author)** | Подготовка изменений к ревью: описание MR/PR, self-review, обеспечение прохождения автоматических проверок, устранение замечаний рецензентов | Разработчик команды продукта |
| **Рецензент (Reviewer)** | Проверка кода по чеклисту, выявление дефектов, ненадёжных участков, нарушений стандарта кодирования, предоставление обоснованных замечаний | Опыт разработки на используемых языках ≥ [ЗАПОЛНИТЬ: 1 год], знание стандарта кодирования продукта |
| **Security-рецензент** | Углублённая проверка безопасности: анализ на типовые уязвимости (OWASP Top 10, CWE Top 25), проверка реализации требований безопасности, оценка модели угроз | Опыт в области ИБ ≥ [ЗАПОЛНИТЬ: 2 года], прохождение обучения по безопасной разработке, знание OWASP, CWE |
| **Ответственный за процесс** | Контроль соблюдения регламента, сбор метрик, актуализация чеклистов, обучение участников, разрешение спорных ситуаций | [ЗАПОЛНИТЬ: руководитель РБПО / техлид / инженер по безопасности] |

### 4.2. Назначение ролей

| Параметр | Значение |
|----------|----------|
| Минимальное количество рецензентов для обязательного ревью | [ЗАПОЛНИТЬ: 1–2] |
| Минимальное количество рецензентов для security-focused ревью | [ЗАПОЛНИТЬ: 2 (включая security-рецензента)] |
| Минимальное количество рецензентов для архитектурного ревью | [ЗАПОЛНИТЬ: 2 (включая архитектора/техлида)] |
| Автор может быть рецензентом собственного кода | Нет |
| Автоматическое назначение рецензентов | [ЗАПОЛНИТЬ: Да / Нет, механизм: CODEOWNERS / round-robin / вручную] |

---

## 5. Процедура проведения экспертизы

### 5.1. Инициирование экспертизы

Экспертиза инициируется при создании merge request (MR) / pull request (PR) в защищённую ветку.

**Требования к MR/PR:**

- Заголовок: краткое описание изменения.
- Описание: контекст изменения, связь с issue/тикетом, перечень затронутых компонентов.
- Метки: тип изменения (feature, fix, security, refactor), требуемый вид ревью.
- Связанные тикеты: ссылка на задачу в трекере.

**Автоматические проверки перед экспертизой:**

Перед назначением рецензентов CI/CD pipeline автоматически выполняет:

| Проверка | Инструмент | Блокирует ревью |
|----------|-----------|-----------------|
| Сборка проекта | [ЗАПОЛНИТЬ: build system] | Да |
| Линтеры и форматирование | [ЗАПОЛНИТЬ: ESLint, Ruff, Prettier] | Да |
| Модульные тесты | [ЗАПОЛНИТЬ: Vitest, pytest] | Да |
| Статический анализ (SAST) | [ЗАПОЛНИТЬ: SonarQube, Semgrep, Bandit] | Да (при Critical/High findings) |
| Проверка зависимостей (SCA) | [ЗАПОЛНИТЬ: Trivy, Dependency-Track] | Да (при Critical findings) |
| Проверка секретов | [ЗАПОЛНИТЬ: GitLeaks, TruffleHog] | Да |

Автор обязан устранить все блокирующие замечания автоматических проверок до запроса ревью.

### 5.2. Назначение рецензентов

**Правила назначения:**

1. Рецензенты назначаются автоматически через [ЗАПОЛНИТЬ: CODEOWNERS / систему назначения] или вручную автором/техлидом.
2. Минимальное количество рецензентов определяется видом экспертизы (см. раздел 4.2).
3. Рецензент не должен быть автором проверяемого кода.
4. Для security-critical paths (перечислены в [ЗАПОЛНИТЬ: файл CODEOWNERS / конфигурация]) обязательно привлечение security-рецензента.

**Security-critical paths (примеры):**

- [ЗАПОЛНИТЬ: src/auth/*, src/crypto/*, src/middleware/security/*]
- [ЗАПОЛНИТЬ: config/security/*, infrastructure/*, Dockerfile*, docker-compose*]
- [ЗАПОЛНИТЬ: */api/*/permissions/*, */models/user*]

### 5.3. Проведение экспертизы

**Порядок проведения:**

1. Рецензент знакомится с описанием MR/PR, связанным тикетом и контекстом изменения.
2. Рецензент изучает результаты автоматических проверок (SAST, линтеры, тесты).
3. Рецензент проводит анализ кода по чеклисту (раздел 6), обращая внимание на:
   - Корректность реализации бизнес-логики.
   - Соответствие стандарту кодирования (документ 02).
   - Безопасность (чеклист раздела 6).
   - Наличие и качество тестов.
   - Наличие ненадёжных участков кода (раздел 7).
4. Рецензент оставляет замечания в системе контроля версий с указанием:
   - Конкретной строки/блока кода.
   - Классификации замечания (раздел 5.4).
   - Обоснования и рекомендации по исправлению.
5. При необходимости рецензент запрашивает дополнительный контекст у автора.

**Рекомендуемое время проведения экспертизы:**

| Объём изменения | Рекомендуемое время | Максимальное время ожидания |
|-----------------|--------------------|-----------------------------|
| Малый (< 100 строк) | [ЗАПОЛНИТЬ: 30 минут] | [ЗАПОЛНИТЬ: 4 часа] |
| Средний (100–500 строк) | [ЗАПОЛНИТЬ: 1–2 часа] | [ЗАПОЛНИТЬ: 1 рабочий день] |
| Большой (> 500 строк) | [ЗАПОЛНИТЬ: 2–4 часа] | [ЗАПОЛНИТЬ: 2 рабочих дня] |

> **Рекомендация:** Объём одного MR/PR не должен превышать [ЗАПОЛНИТЬ: 400–500] строк изменённого кода. Крупные изменения следует разбивать на серию меньших MR/PR.

### 5.4. Обработка замечаний

**Классификация замечаний:**

| Тип замечания | Обозначение | Описание | Обязательность устранения |
|---------------|-------------|----------|---------------------------|
| **Блокирующее** | `[BLOCK]` | Дефект, уязвимость, нарушение стандарта кодирования или требований безопасности. MR/PR не может быть принят без устранения | Обязательно |
| **Рекомендация** | `[SUGGESTION]` | Предложение по улучшению: рефакторинг, оптимизация, лучшая практика. Автор может принять или обосновать отклонение | По решению автора |
| **Вопрос** | `[QUESTION]` | Запрос на пояснение: непонятная логика, неочевидное решение. Требуется ответ автора, но не обязательно изменение кода | Требуется ответ |
| **Информационное** | `[INFO]` | Наблюдение, не требующее действий: комплимент, информация к сведению, ссылка на документацию | Не требуется |

**Порядок обработки:**

1. Автор рассматривает каждое замечание.
2. Для блокирующих замечаний — устраняет и помечает как resolved.
3. Для рекомендаций — принимает или обосновывает отклонение в комментарии.
4. Для вопросов — предоставляет пояснение.
5. Рецензент верифицирует устранение блокирующих замечаний.

### 5.5. Принятие решения

| Решение | Условие | Действие |
|---------|---------|----------|
| **Approve** | Все блокирующие замечания устранены, код соответствует стандарту и требованиям безопасности | MR/PR может быть влит в целевую ветку |
| **Request Changes** | Имеются блокирующие замечания или ненадёжные участки кода, требующие доработки | Автор устраняет замечания, затем повторное ревью |
| **Reject** | Концептуально неверный подход, требуется переработка архитектуры решения | MR/PR закрывается, создаётся новый после переработки |

**Условия слияния MR/PR:**

- Все обязательные рецензенты поставили Approve.
- Все блокирующие замечания устранены (resolved).
- Все автоматические проверки CI/CD пройдены.
- Нет открытых findings уровня Critical/High от SAST.
- Ветка актуальна (rebased/merged) относительно целевой ветки.

### 5.6. Повторная экспертиза

Повторная экспертиза проводится в следующих случаях:

- Автор внёс существенные изменения после первого ревью.
- Были устранены блокирующие замечания — рецензент верифицирует устранение.
- Рецензент отозвал ранее поставленный Approve из-за новых изменений.

При повторной экспертизе рецензент фокусируется на:

1. Корректности устранения замечаний.
2. Отсутствии регрессий от внесённых изменений.
3. Новых участках кода, добавленных после первого ревью.

### 5.7. Схема процесса экспертизы

```
Автор                          CI/CD                        Рецензент(ы)
  │                              │                              │
  │  1. Создание MR/PR           │                              │
  ├─────────────────────────────►│                              │
  │                              │  2. Автоматические проверки  │
  │                              │  (сборка, линтеры, тесты,    │
  │                              │   SAST, SCA, секреты)        │
  │                              │                              │
  │  ┌───── FAIL ───────────────┤                              │
  │  │                           │                              │
  │  │  3. Устранение            │                              │
  │  │     автоматических        │                              │
  │  │     замечаний             │                              │
  │  │                           │                              │
  │  └──────────────────────────►│                              │
  │                              │                              │
  │                              ├── PASS ─────────────────────►│
  │                              │                              │
  │                              │  4. Назначение рецензентов   │
  │                              │                              │
  │                              │              5. Экспертиза   │
  │                              │              по чеклисту     │
  │                              │                              │
  │  6. Замечания ◄─────────────────────────────────────────────┤
  │                              │                              │
  │  7. Устранение замечаний     │                              │
  │     + ответы на вопросы      │                              │
  │                              │                              │
  ├─────────────────────────────────────────────────────────────►│
  │                              │                              │
  │                              │              8. Верификация  │
  │                              │              исправлений     │
  │                              │                              │
  │  9. Approve ◄───────────────────────────────────────────────┤
  │                              │                              │
  │  10. Merge MR/PR             │                              │
  ├─────────────────────────────►│                              │
  │                              │                              │
```

---

## 6. Чеклист безопасности при экспертизе

### 6.1. Общий чеклист экспертизы

> Данный чеклист применяется при каждой экспертизе. Для security-focused ревью дополнительно применяется расширенный чеклист (раздел 6.2).

| # | Категория | Пункт проверки | Ссылка |
|---|-----------|----------------|--------|
| 1 | Логика | Корректность реализации бизнес-логики, соответствие описанию задачи | — |
| 2 | Логика | Обработка граничных случаев (пустые значения, null, overflow) | CWE-754 |
| 3 | Стиль | Соответствие стандарту кодирования (документ 02) | п. 5.8 |
| 4 | Стиль | Осмысленные имена переменных, функций, классов | — |
| 5 | Стиль | Отсутствие закомментированного кода и отладочных артефактов | — |
| 6 | Тесты | Наличие unit-тестов для новой/изменённой логики | — |
| 7 | Тесты | Покрытие негативных сценариев (ошибки, невалидный ввод) | — |
| 8 | Тесты | Тесты проходят успешно | — |
| 9 | Документация | Обновлены комментарии, docstrings, README при изменении API | — |
| 10 | Зависимости | Новые зависимости обоснованы, лицензия совместима, версия зафиксирована | — |

### 6.2. Расширенный чеклист безопасности

| # | Категория | Пункт проверки | CWE | Примеры/Пояснение |
|---|-----------|----------------|-----|-------------------|
| 1 | **Входные данные** | Все пользовательские входные данные валидируются на стороне сервера | CWE-20 | Whitelist-валидация, проверка типов, диапазонов, длины |
| 2 | **Входные данные** | Параметризованные запросы для взаимодействия с БД (нет конкатенации строк) | CWE-89 | SQL injection, ORM injection |
| 3 | **Входные данные** | Экранирование данных при выводе в HTML/JS/CSS | CWE-79 | XSS: reflected, stored, DOM-based |
| 4 | **Входные данные** | Защита от инъекций в команды ОС | CWE-78 | OS command injection, использование subprocess с shell=False |
| 5 | **Входные данные** | Защита от path traversal при работе с файловой системой | CWE-22 | Нормализация путей, проверка корневой директории |
| 6 | **Входные данные** | Защита от SSRF при обработке URL из пользовательского ввода | CWE-918 | Валидация URL, запрет обращения к внутренним адресам |
| 7 | **Входные данные** | Защита от XML External Entity (XXE) при парсинге XML | CWE-611 | Отключение внешних сущностей в парсере |
| 8 | **Входные данные** | Десериализация данных только из доверенных источников | CWE-502 | Запрет десериализации произвольных объектов (pickle, yaml.load) |
| 9 | **Аутентификация** | Безопасное хранение паролей (bcrypt/argon2, salt) | CWE-916 | Нет хранения в открытом виде или MD5/SHA1 без salt |
| 10 | **Аутентификация** | Защита от brute force (rate limiting, account lockout) | CWE-307 | Ограничение попыток входа |
| 11 | **Аутентификация** | Безопасная генерация токенов (CSPRNG, достаточная энтропия) | CWE-330 | Использование secrets модуля, не random |
| 12 | **Авторизация** | Проверка прав доступа на каждом уровне (API, сервис, данные) | CWE-862 | Нет прямого доступа к объектам без проверки прав (IDOR) |
| 13 | **Авторизация** | Принцип наименьших привилегий | CWE-269 | Минимально необходимые права для каждой операции |
| 14 | **Криптография** | Использование актуальных алгоритмов (AES-256, RSA-2048+, SHA-256+) | CWE-327 | Нет MD5, DES, RC4, SHA-1 для криптографических целей |
| 15 | **Криптография** | Корректное использование IV/nonce (уникальность, случайность) | CWE-329 | Нет повторного использования IV |
| 16 | **Криптография** | Безопасное хранение и передача ключей (не в коде, не в логах) | CWE-798 | Использование vault, переменных окружения |
| 17 | **Обработка ошибок** | Нет раскрытия внутренней информации в сообщениях об ошибках | CWE-209 | Stack traces, пути файлов, версии ПО не видны пользователю |
| 18 | **Обработка ошибок** | Все исключения обрабатываются, нет необработанных crash-сценариев | CWE-755 | Try/catch для внешних операций (сеть, ФС, БД) |
| 19 | **Обработка ошибок** | Fail-safe defaults: при ошибке система переходит в безопасное состояние | CWE-636 | Отказ в доступе при ошибке авторизации, а не предоставление |
| 20 | **Логирование** | Отсутствие секретов в логах (пароли, токены, ключи, PII) | CWE-532 | Маскирование чувствительных данных в логах |
| 21 | **Логирование** | Логирование событий безопасности (аутентификация, авторизация, ошибки) | CWE-778 | Аудитный журнал для security-relevant событий |
| 22 | **Логирование** | Защита от log injection (экранирование пользовательских данных) | CWE-117 | Нет возможности инъекции в формат лога |
| 23 | **Ресурсы** | Ограничение потребления ресурсов (размер загружаемых файлов, количество запросов) | CWE-400 | Rate limiting, max file size, timeout |
| 24 | **Ресурсы** | Корректное освобождение ресурсов (соединения, файлы, блокировки) | CWE-404 | Context managers, try/finally, using/defer |
| 25 | **Ресурсы** | Защита от ReDoS (регулярные выражения без катастрофического backtracking) | CWE-1333 | Проверка regex на экспоненциальное время |
| 26 | **Зависимости** | Новые зависимости не содержат известных уязвимостей | CWE-1104 | Проверка через SCA перед включением |
| 27 | **Зависимости** | Зависимости загружаются из доверенных источников с верификацией целостности | CWE-494 | Lock-файлы с хэшами, подписанные пакеты |
| 28 | **Конфиденциальность** | Отсутствие hardcoded секретов (API-ключи, пароли, токены) | CWE-798 | Использование переменных окружения, vault |
| 29 | **Конфиденциальность** | Нет включения чувствительных данных в URL-параметры | CWE-598 | Передача через заголовки или тело запроса |

---

## 7. Выявление ненадёжных участков кода

### 7.1. Определение

Ненадёжный (потенциально уязвимый) участок кода — фрагмент исходного кода, который по своим характеристикам с высокой вероятностью может содержать уязвимость или стать источником уязвимости в будущем, даже если в текущий момент эксплуатируемая уязвимость не подтверждена.

> Требование ГОСТ Р 56939-2024, п. 5.9.2 — выявлять ненадёжные (потенциально уязвимые) участки кода.

### 7.2. Критерии ненадёжности

| # | Признак ненадёжности | Примеры | Действия |
|---|---------------------|---------|----------|
| 1 | **Обработка внешних данных без валидации** | Прямое использование `request.GET`, `request.body`, `argv` без проверки | Добавить валидацию на входе; зарегистрировать как дефект |
| 2 | **Динамическое формирование запросов** | Конкатенация строк для SQL, LDAP, XPath, OS-команд | Заменить на параметризованные запросы; зарегистрировать как уязвимость |
| 3 | **Собственная реализация криптографии** | Самописные алгоритмы шифрования, хэширования, генерации случайных чисел | Заменить на стандартные библиотеки; зарегистрировать как уязвимость |
| 4 | **Избыточные привилегии** | Запуск от root, широкие права доступа к файлам (777), полный доступ к БД | Применить принцип наименьших привилегий; зарегистрировать как дефект |
| 5 | **Отсутствие обработки ошибок** | Пустые catch-блоки, игнорирование return-кодов, отсутствие timeout | Добавить обработку; зарегистрировать как дефект |
| 6 | **Высокая цикломатическая сложность** | Функции с > [ЗАПОЛНИТЬ: 15–20] ветвлений, глубокая вложенность | Провести рефакторинг; запланировать как tech debt |
| 7 | **Отключённые security-механизмы** | `verify=False`, `CSRF_EXEMPT`, `allowAll`, `dangerouslySetInnerHTML` | Обосновать необходимость или включить; зарегистрировать как уязвимость |
| 8 | **Устаревшие/небезопасные API** | Использование deprecated функций, небезопасных протоколов (HTTP, FTP, telnet) | Заменить на актуальные безопасные аналоги; зарегистрировать как дефект |
| 9 | **Жёстко заданные значения (hardcoded)** | IP-адреса, URL, пороговые значения, credentials в коде | Вынести в конфигурацию; для credentials — зарегистрировать как уязвимость |
| 10 | **Отсутствие ограничений ресурсов** | Нет лимитов на размер ввода, количество итераций, время выполнения | Добавить ограничения; зарегистрировать как дефект |

### 7.3. Маркировка ненадёжных участков

При выявлении ненадёжного участка рецензент:

1. Создаёт блокирующее замечание `[BLOCK]` с описанием проблемы и CWE-ссылкой.
2. Если замечание не может быть устранено в рамках текущего MR/PR — регистрирует дефект/уязвимость в трекере (по процессу 5.5, документ 04).
3. Отмечает участок в реестре результатов экспертизы (раздел 10).

### 7.4. Связь с SAST

> Требование ГОСТ Р 56939-2024, п. 5.10 — результаты SAST дополняют экспертизу.

Результаты статического анализа (документ 09 — Регламент статического анализа) используются при экспертизе:

- Рецензент изучает findings SAST в отчёте CI/CD pipeline перед началом ревью.
- Findings уровня Critical и High от SAST должны быть устранены или подтверждены как false positive с обоснованием.
- SAST не заменяет ручную экспертизу: автоматический анализ не способен выявить логические уязвимости, нарушения бизнес-логики, ошибки проектирования.
- Рецензент может рекомендовать добавление пользовательских правил SAST при обнаружении повторяющихся паттернов уязвимостей.

---

## 8. Инструменты автоматизации

### 8.1. Набор инструментов

| Инструмент | Назначение | Этап применения |
|------------|-----------|-----------------|
| [ЗАПОЛНИТЬ: GitLab / GitHub / Bitbucket] | Платформа для проведения code review (MR/PR) | Весь процесс |
| [ЗАПОЛНИТЬ: SonarQube / SonarCloud] | Статический анализ качества и безопасности кода | Pre-review (CI/CD) |
| [ЗАПОЛНИТЬ: Semgrep] | Поиск уязвимых паттернов по пользовательским правилам | Pre-review (CI/CD) |
| [ЗАПОЛНИТЬ: Bandit / ESLint security plugins] | Language-specific security linters | Pre-review (CI/CD) |
| [ЗАПОЛНИТЬ: GitLeaks / TruffleHog] | Обнаружение секретов в коде и истории Git | Pre-review (CI/CD) |
| [ЗАПОЛНИТЬ: Trivy / Dependency-Track] | Анализ уязвимостей в зависимостях (SCA) | Pre-review (CI/CD) |
| [ЗАПОЛНИТЬ: Prettier / Ruff / Black] | Автоформатирование кода | Pre-review (CI/CD) |
| [ЗАПОЛНИТЬ: Danger / Reviewbot] | Автоматические проверки MR/PR (размер, описание, метки) | During review |
| [ЗАПОЛНИТЬ: CodeClimate / SonarQube] | Оценка сложности, дублирования, покрытия | During review |
| [ЗАПОЛНИТЬ: система метрик] | Сбор метрик процесса экспертизы | Post-review |

### 8.2. Интеграция с CI/CD

```
┌─────────────────────────────────────────────────────────────────┐
│                        CI/CD Pipeline                           │
│                                                                 │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌────────────────┐  │
│  │  Build    │→│  Lint     │→│  Test     │→│  Security Scan  │  │
│  │          │  │          │  │          │  │  (SAST, SCA,   │  │
│  │          │  │          │  │          │  │   Secrets)      │  │
│  └──────────┘  └──────────┘  └──────────┘  └───────┬────────┘  │
│                                                     │           │
│                                              ┌──────▼────────┐  │
│                                              │  Quality Gate  │  │
│                                              │  (Pass/Fail)   │  │
│                                              └───────┬────────┘  │
│                                                      │           │
└──────────────────────────────────────────────────────┼───────────┘
                                                       │
                                              ┌────────▼────────┐
                                              │  Code Review     │
                                              │  (Manual)        │
                                              └─────────────────┘
```

### 8.3. Автоматические проверки перед экспертизой

Список обязательных автоматических проверок, результаты которых доступны рецензенту:

| Проверка | Описание | Критерий прохождения |
|----------|----------|---------------------|
| Build | Успешная сборка проекта | Exit code 0 |
| Lint | Соответствие стандарту кодирования | 0 ошибок линтера |
| Unit tests | Прохождение модульных тестов | 100% тестов прошли |
| Coverage | Покрытие кода тестами | ≥ [ЗАПОЛНИТЬ: 80%] для нового кода |
| SAST | Статический анализ безопасности | 0 findings Critical/High (или accepted) |
| SCA | Анализ зависимостей | 0 findings Critical (или accepted) |
| Secrets | Поиск секретов | 0 findings |
| MR size | Размер изменения | ≤ [ЗАПОЛНИТЬ: 500] строк (предупреждение) |

---

## 9. Метрики и контроль качества

### 9.1. Метрики процесса экспертизы

| Метрика | Описание | Целевое значение |
|---------|----------|------------------|
| **Review Coverage** | Процент MR/PR, прошедших экспертизу, от общего числа | [ЗАПОЛНИТЬ: 100%] |
| **Time to First Review** | Среднее время от создания MR/PR до первого замечания рецензента | [ЗАПОЛНИТЬ: ≤ 4 часа в рабочее время] |
| **Time to Merge** | Среднее время от создания MR/PR до слияния | [ЗАПОЛНИТЬ: ≤ 2 рабочих дней] |
| **Review Iteration Count** | Среднее количество итераций ревью (request changes → re-review) | [ЗАПОЛНИТЬ: ≤ 2] |
| **Defect Detection Rate** | Количество дефектов, выявленных при экспертизе, на 1000 строк проверенного кода | [ЗАПОЛНИТЬ: мониторинг тренда] |
| **Security Finding Rate** | Количество замечаний безопасности, выявленных при экспертизе | [ЗАПОЛНИТЬ: мониторинг тренда] |
| **Review Comment Density** | Среднее количество замечаний на MR/PR | [ЗАПОЛНИТЬ: мониторинг тренда] |
| **Escaped Defect Rate** | Процент дефектов, пропущенных при ревью и обнаруженных позже (при тестировании, в продакшене) | [ЗАПОЛНИТЬ: ≤ 10%] |
| **MR/PR Size** | Средний размер MR/PR (строки кода) | [ЗАПОЛНИТЬ: ≤ 300 строк] |
| **Self-Review Rate** | Процент MR/PR, где автор провёл self-review до назначения рецензентов | [ЗАПОЛНИТЬ: 100%] |

### 9.2. Периодичность сбора метрик

| Мероприятие | Периодичность | Ответственный |
|-------------|---------------|---------------|
| Автоматический сбор метрик из платформы (GitLab/GitHub) | Непрерывно | [ЗАПОЛНИТЬ: CI/CD система] |
| Формирование отчёта по метрикам | [ЗАПОЛНИТЬ: еженедельно / ежемесячно] | [ЗАПОЛНИТЬ: ответственный за процесс] |
| Анализ трендов и корректирующие действия | [ЗАПОЛНИТЬ: ежемесячно] | [ЗАПОЛНИТЬ: ответственный за процесс, техлид] |
| Ретроспектива процесса экспертизы | [ЗАПОЛНИТЬ: ежеквартально] | [ЗАПОЛНИТЬ: ответственный за процесс] |

### 9.3. Контроль соблюдения регламента

| Нарушение | Индикатор | Корректирующее действие |
|-----------|-----------|------------------------|
| MR/PR влит без ревью | 0 approvals при слиянии | Разбор инцидента, усиление branch protection rules |
| Пропущена security-уязвимость | Обнаружена на последующих этапах (тестирование, DAST, пентест) | Обновление чеклиста, дополнительное обучение рецензентов |
| Нарушение SLA по времени ревью | Time to First Review / Time to Merge превышает целевое значение | Перераспределение нагрузки, увеличение числа рецензентов |
| Формальное ревью (0 замечаний на крупный MR/PR) | Review Comment Density = 0 при > 200 строк | Разбор с рецензентом, обучение |

---

## 10. Реестр результатов экспертизы

### 10.1. Формат реестра

> Требование ГОСТ Р 56939-2024, п. 5.9.2 — документировать результаты экспертизы.

Результаты экспертизы фиксируются в системе контроля версий (в MR/PR) и дополнительно в сводном реестре:

| ID MR/PR | Дата | Автор | Рецензент(ы) | Вид экспертизы | Компоненты | Замечания (блок./рек./вопр.) | Ненадёжные участки | Решение | Связанные тикеты |
|----------|------|-------|-------------|----------------|------------|-----------------------------|--------------------|---------|-------------------|
| [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |

### 10.2. Хранение и доступ

| Параметр | Значение |
|----------|----------|
| Первичное хранение | [ЗАПОЛНИТЬ: GitLab/GitHub — MR/PR с комментариями и обсуждениями] |
| Сводный реестр | [ЗАПОЛНИТЬ: Confluence / SharePoint / внутренняя wiki] |
| Срок хранения | [ЗАПОЛНИТЬ: не менее 5 лет / срок действия сертификата + 1 год] |
| Доступ к реестру | [ЗАПОЛНИТЬ: команда разработки, инженеры по безопасности, аудиторы] |
| Резервное копирование | [ЗАПОЛНИТЬ: периодичность и способ] |

### 10.3. Отчётность

По результатам экспертизы формируются следующие отчёты:

| Отчёт | Периодичность | Содержание | Получатели |
|-------|---------------|-----------|------------|
| Сводка по экспертизе | [ЗАПОЛНИТЬ: еженедельно] | Количество MR/PR, замечания по категориям, выявленные уязвимости | [ЗАПОЛНИТЬ: команда разработки] |
| Отчёт по безопасности | [ЗАПОЛНИТЬ: ежемесячно] | Security findings, ненадёжные участки, тренды | [ЗАПОЛНИТЬ: руководитель РБПО, инженер по безопасности] |
| Отчёт по метрикам | [ЗАПОЛНИТЬ: ежемесячно] | Метрики раздела 9, динамика, отклонения | [ЗАПОЛНИТЬ: ответственный за процесс, руководство] |
| Отчёт для аудита/сертификации | [ЗАПОЛНИТЬ: по запросу] | Полный реестр, покрытие, соответствие ГОСТ | [ЗАПОЛНИТЬ: аудиторы, сертификационная лаборатория] |

---

## 11. История изменений

| Версия | Дата | Описание изменений | Автор |
|--------|------|--------------------|-------|
| 1.0 | [ЗАПОЛНИТЬ: дата] | Первая версия документа | [ЗАПОЛНИТЬ: ФИО] |
