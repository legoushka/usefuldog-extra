# Политика управления секретами

| | |
|---|---|
| **Продукт** | [ЗАПОЛНИТЬ: наименование СЗИ] |
| **Версия документа** | 1.0 |
| **Дата** | [ЗАПОЛНИТЬ: дата утверждения] |
| **Статус** | Проект |
| **Утверждено** | [ЗАПОЛНИТЬ: должность, ФИО руководителя] |
| **Процесс ГОСТ Р 56939-2024** | 5.15 — Обеспечение безопасности используемых секретов |

---

## Содержание

1. [Общие сведения](#1-общие-сведения)
2. [Область применения](#2-область-применения)
3. [Классификация секретов](#3-классификация-секретов)
4. [Инструменты управления секретами](#4-инструменты-управления-секретами)
5. [Запрет хранения секретов в коде](#5-запрет-хранения-секретов-в-коде)
6. [Порядок создания и распространения секретов](#6-порядок-создания-и-распространения-секретов)
7. [Ротация секретов](#7-ротация-секретов)
8. [Контроль доступа к секретам](#8-контроль-доступа-к-секретам)
9. [Реагирование при компрометации секрета](#9-реагирование-при-компрометации-секрета)
10. [Реестр секретов](#10-реестр-секретов)
11. [История изменений](#11-история-изменений)

---

## 1. Общие сведения

### 1.1. Назначение документа

Настоящая Политика определяет порядок:

- Классификации и инвентаризации секретов (пароли, API-ключи, сертификаты, токены, SSH-ключи).
- Использования систем управления секретами (Vault, GitHub Secrets, SOPS и др.).
- Запрета хранения секретов непосредственно в исходном коде и конфигурационных файлах.
- Создания, распространения и безопасной передачи секретов.
- Ротации секретов по регламенту.
- Контроля доступа к секретам на основе принципа минимальных привилегий.
- Реагирования при подозрении на компрометацию секрета.

Политика разработана в соответствии с требованиями ГОСТ Р 56939-2024, п. 5.15 (обеспечение безопасности используемых секретов) и п. 5.15.2, которые устанавливают необходимость:

- Использовать систему управления секретами (Vault, GitHub Secrets и др.).
- Исключить хранение паролей, ключей и токенов непосредственно в коде.
- Ротировать секреты по регламенту.
- Контролировать доступ к секретам.

### 1.2. Нормативные ссылки

| Документ | Описание |
|----------|----------|
| ГОСТ Р 56939-2024, п. 5.15 | Обеспечение безопасности используемых секретов — основной процесс |
| ГОСТ Р 56939-2024, п. 5.15.2 | Требования к процессу обеспечения безопасности секретов |
| ГОСТ Р 56939-2024, п. 5.13 | Обеспечение безопасности сборочной среды — секреты в CI/CD |
| ГОСТ Р 56939-2024, п. 5.14 | Управление доступом к коду — SSH-ключи и access tokens |
| ГОСТ Р 56939-2024, п. 5.5 | Управление недостатками — утечка секрета как инцидент |
| CWE-798 | Use of Hard-coded Credentials |
| CWE-259 | Use of Hard-coded Password |
| CWE-321 | Use of Hard-coded Cryptographic Key |
| OWASP Secrets Management Cheat Sheet | Руководство по управлению секретами |

### 1.3. Связь с другими документами комплекта РБПО

| Документ РБПО | Связь |
|----------------|-------|
| 04 — Регламент управления недостатками | Утечка секрета регистрируется как инцидент безопасности и обрабатывается по процессу 5.5 |
| 12 — Регламент безопасности сборочной среды | Секреты в CI/CD (токены registry, signing keys) — часть защиты сборочной среды (процесс 5.13) |
| 13 — Регламент управления доступом к коду | SSH-ключи и access tokens для доступа к VCS — управляются как секреты по настоящей политике |
| 11 — Регламент безопасной сборки | Ключи подписания артефактов — секреты, используемые при сборке (процесс 5.12) |

---

## 2. Область применения

### 2.1. Типы секретов

Настоящая Политика распространяется на следующие типы секретов:

| Тип секрета | Описание | Примеры |
|-------------|----------|---------|
| **Пароли** | Учётные данные для аутентификации в системах | Пароли к БД, LDAP, admin-панелям, service accounts |
| **API-ключи** | Ключи для доступа к внешним и внутренним API | API-ключи облачных сервисов, внутренних микросервисов, SaaS-интеграций |
| **Токены доступа** | Токены для аутентификации в системах | OAuth2 tokens, personal access tokens (VCS), CI/CD tokens, JWT signing secrets |
| **Сертификаты и ключи TLS/SSL** | Криптографические сертификаты и закрытые ключи | TLS-сертификаты серверов, mTLS client certificates, CA certificates |
| **SSH-ключи** | Ключи для SSH-аутентификации | Deploy keys, ключи доступа к серверам, ключи подписи коммитов |
| **Ключи шифрования** | Криптографические ключи для шифрования данных | Ключи шифрования БД, ключи шифрования бэкапов, ключи подписания артефактов |
| **Секреты приложения** | Специфичные для приложения секреты | Session secret, CSRF secret, encryption salt, webhook secrets |
| **Credentials баз данных** | Учётные данные для подключения к СУБД | Connection strings, username/password для PostgreSQL, Redis, MongoDB |
| **Cloud credentials** | Учётные данные облачных провайдеров | AWS Access Key / Secret Key, GCP Service Account Key, Azure credentials |

### 2.2. Среды применения

| Среда | Примеры секретов | Способ управления |
|-------|-----------------|-------------------|
| **Development** | API-ключи тестовых сервисов, тестовые пароли БД | [ЗАПОЛНИТЬ: .env.local (не в VCS), Vault dev mode] |
| **CI/CD** | Registry tokens, signing keys, deploy credentials, SAST tokens | [ЗАПОЛНИТЬ: CI/CD protected variables, Vault] |
| **Staging** | Credentials staging-сервисов, staging DB passwords | [ЗАПОЛНИТЬ: Vault, CI/CD secrets] |
| **Production** | Production DB credentials, TLS certificates, encryption keys | [ЗАПОЛНИТЬ: Vault (production), HSM, KMS] |

---

## 3. Классификация секретов

### 3.1. По уровню критичности

| Уровень | Описание | Примеры | Требования к защите |
|---------|----------|---------|---------------------|
| **Critical** | Компрометация ведёт к полной компрометации системы, утечке данных, невозможности восстановления | Production DB root password, TLS private key, master encryption key, signing key | Хранение в HSM/KMS; доступ ≤ 2 человек; ротация [ЗАПОЛНИТЬ: ≤ 90 дней]; MFA для доступа |
| **High** | Компрометация ведёт к значительному воздействию на безопасность или работоспособность | API-ключи production-сервисов, CI/CD deploy credentials, OAuth2 client secret | Хранение в Vault; доступ по принципу минимальных привилегий; ротация [ЗАПОЛНИТЬ: ≤ 180 дней] |
| **Medium** | Компрометация ведёт к ограниченному воздействию; секрет можно быстро отозвать | Personal access tokens, staging credentials, webhook secrets | Хранение в Vault / CI/CD secrets; ротация [ЗАПОЛНИТЬ: ≤ 365 дней] |
| **Low** | Минимальное воздействие; тестовые/демо секреты без доступа к реальным данным | Development API keys, test DB passwords, demo credentials | Допускается хранение в .env.local (не в VCS); ротация по необходимости |

### 3.2. По назначению

| Назначение | Тип секрета | Владелец | Среда |
|-----------|-------------|----------|-------|
| Аутентификация в СУБД | Password / connection string | [ЗАПОЛНИТЬ: DBA / DevOps] | Dev, Staging, Production |
| Доступ к внешним API | API key / OAuth2 token | [ЗАПОЛНИТЬ: команда интеграций] | Staging, Production |
| Подписание артефактов | Signing key (GPG / cosign) | [ЗАПОЛНИТЬ: Security / Release Manager] | CI/CD |
| TLS/SSL | Certificate + private key | [ЗАПОЛНИТЬ: DevOps / Security] | Staging, Production |
| Доступ к VCS | SSH key / personal access token | [ЗАПОЛНИТЬ: каждый разработчик / service account] | Dev, CI/CD |
| CI/CD операции | Registry token, deploy key | [ЗАПОЛНИТЬ: DevOps] | CI/CD |
| Шифрование данных | Encryption key | [ЗАПОЛНИТЬ: Security / DBA] | Production |
| [ЗАПОЛНИТЬ: дополнительные] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |

---

## 4. Инструменты управления секретами

### 4.1. Реестр инструментов

> Требование ГОСТ Р 56939-2024, п. 5.15.2 — использовать систему управления секретами.

| Инструмент | Версия | Назначение | Среда | Статус |
|-----------|--------|-----------|-------|--------|
| [ЗАПОЛНИТЬ: HashiCorp Vault] | [ЗАПОЛНИТЬ: ≥ 1.15] | Централизованное хранение и выдача секретов для приложений и CI/CD | Staging, Production, CI/CD | [ЗАПОЛНИТЬ: используется / планируется] |
| [ЗАПОЛНИТЬ: GitLab CI Variables / GitHub Secrets] | Встроенный | Хранение секретов для CI/CD пайплайнов | CI/CD | [ЗАПОЛНИТЬ: используется] |
| [ЗАПОЛНИТЬ: SOPS (Secrets OPerationS)] | [ЗАПОЛНИТЬ: ≥ 3.8] | Шифрование файлов конфигурации с секретами для хранения в VCS | Dev, Staging | [ЗАПОЛНИТЬ: используется / планируется] |
| [ЗАПОЛНИТЬ: AWS KMS / GCP KMS / Azure Key Vault] | — | Управление ключами шифрования в облачной инфраструктуре | Production | [ЗАПОЛНИТЬ: используется / не применимо] |
| [ЗАПОЛНИТЬ: дополнительные] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |

### 4.2. Требования к системе управления секретами

| Требование | Описание |
|-----------|----------|
| **Шифрование at rest** | Секреты хранятся в зашифрованном виде; ключ шифрования хранилища защищён (seal/unseal, KMS) |
| **Шифрование in transit** | Все обращения к хранилищу — по TLS 1.2+ |
| **Аудит доступа** | Логирование всех операций: чтение, создание, обновление, удаление секретов |
| **RBAC** | Доступ к секретам на основе ролей; каждый сервис/пользователь видит только свои секреты |
| **Ротация** | Поддержка автоматической ротации секретов (dynamic secrets, lease renewal) |
| **Высокая доступность** | [ЗАПОЛНИТЬ: HA-кластер / single instance с backup] |
| **Backup** | Регулярное резервное копирование хранилища секретов |
| **Disaster recovery** | Документированная процедура восстановления хранилища секретов |

### 4.3. Интеграция с CI/CD

| Этап | Как секреты попадают в пайплайн | Инструмент |
|------|--------------------------------|-----------|
| Build | Переменные окружения CI/CD (masked + protected) или Vault injection | [ЗАПОЛНИТЬ: GitLab CI Variables / GitHub Secrets / Vault Agent] |
| Test | Тестовые секреты из CI/CD переменных (отдельные от production) | [ЗАПОЛНИТЬ] |
| Deploy | Credentials для deployment среды из Vault (short-lived tokens) | [ЗАПОЛНИТЬ: Vault / CI/CD secrets] |
| Sign | Signing key из Vault / KMS (не хранится на runner) | [ЗАПОЛНИТЬ: Vault transit / cosign + KMS] |

**Правила инъекции секретов в CI/CD:**

| Правило | Описание |
|---------|----------|
| Masked variables | Все секреты помечены как masked — не отображаются в логах |
| Protected variables | Секреты production доступны только из protected ветвей |
| Environment-scoped | Секреты привязаны к конкретной среде (dev/staging/prod) |
| No export to artifacts | Секреты не сохраняются в артефакты сборки |
| Ephemeral | Секреты доступны только во время выполнения job; после завершения — удаляются с runner |
| No secrets in Dockerfile | Запрещено передавать секреты через `ARG` / `ENV` в Dockerfile (используются multi-stage builds или runtime injection) |

---

## 5. Запрет хранения секретов в коде

### 5.1. Общее правило

> Требование ГОСТ Р 56939-2024, п. 5.15.2 — исключить хранение паролей, ключей и токенов непосредственно в коде.

**Запрещено** хранение секретов:

- В исходном коде (hardcoded в .py, .ts, .js, .go и других файлах).
- В конфигурационных файлах, хранящихся в VCS (.env, config.json, application.yml и др.).
- В Dockerfile (через `ARG` / `ENV` с реальными значениями).
- В CI/CD конфигурации (inline значения в .gitlab-ci.yml / .github/workflows/).
- В комментариях к коду.
- В истории Git (ранее добавленные и затем удалённые секреты всё ещё доступны в истории).
- В README, документации, Wiki.

### 5.2. Допустимые способы использования секретов

| Способ | Описание | Применимость |
|--------|----------|-------------|
| **Переменные окружения** | Секреты передаются через переменные окружения при запуске | Development, CI/CD, Production |
| **Vault / Secret Manager** | Секреты извлекаются из хранилища при запуске приложения / CI/CD job | CI/CD, Staging, Production |
| **Mounted secrets** | Секреты монтируются как файлы в контейнер (Kubernetes Secrets, Docker secrets) | Staging, Production |
| **SOPS** | Зашифрованные файлы конфигурации хранятся в VCS; расшифровка при deployment | [ЗАПОЛНИТЬ: при необходимости] |
| **.env.local** | Локальный файл с секретами для разработки (добавлен в .gitignore) | Development |

### 5.3. Автоматическое обнаружение секретов

| Уровень | Инструмент | Когда срабатывает | Действие при обнаружении |
|---------|-----------|-------------------|--------------------------|
| **Pre-commit hook** | [ЗАПОЛНИТЬ: GitLeaks / detect-secrets / TruffleHog] | Перед каждым `git commit` на машине разработчика | Блокировка коммита; предупреждение разработчику |
| **CI/CD pipeline** | [ЗАПОЛНИТЬ: GitLeaks / TruffleHog / GitHub Secret Scanning] | При каждом push / PR | Блокировка pipeline; уведомление Security |
| **Scheduled scan** | [ЗАПОЛНИТЬ: TruffleHog / GitLeaks] | По расписанию — сканирование всей истории Git | Уведомление Security; регистрация инцидента |
| **VCS platform** | [ЗАПОЛНИТЬ: GitHub Secret Scanning / GitLab Secret Detection] | Автоматически при push | Уведомление владельца секрета; блокировка (при поддержке) |

### 5.4. Конфигурация pre-commit hook

> Пример конфигурации. Адаптировать под используемый инструмент.

```yaml
# .pre-commit-config.yaml (пример для detect-secrets / gitleaks)
repos:
  - repo: https://github.com/gitleaks/gitleaks
    rev: [ЗАПОЛНИТЬ: версия]
    hooks:
      - id: gitleaks
```

### 5.5. Шаблон .env.example

Вместо реальных секретов в репозитории хранится шаблон `.env.example` с описанием переменных:

```
# .env.example — шаблон переменных окружения
# Скопировать в .env.local и заполнить реальными значениями
# .env.local НЕ коммитится в VCS (добавлен в .gitignore)

DATABASE_URL=postgresql://user:password@localhost:5432/dbname
API_KEY=your-api-key-here
SECRET_KEY=your-secret-key-here
```

### 5.6. .gitignore

Файлы с секретами должны быть добавлены в `.gitignore`:

```
# Secrets (NEVER commit)
.env
.env.local
.env.*.local
*.key
*.pem
credentials.json
service-account.json
```

---

## 6. Порядок создания и распространения секретов

### 6.1. Генерация секретов

| Правило | Описание |
|---------|----------|
| **CSPRNG** | Секреты генерируются с использованием криптографически стойкого генератора случайных чисел (CSPRNG): `secrets` модуль Python, `crypto.randomBytes` Node.js, `/dev/urandom` |
| **Достаточная длина** | Пароли: ≥ [ЗАПОЛНИТЬ: 16 символов]; API-ключи: ≥ [ЗАПОЛНИТЬ: 32 символа]; Encryption keys: ≥ [ЗАПОЛНИТЬ: 256 бит] |
| **Уникальность** | Каждый секрет — уникален; запрещено повторное использование секретов между средами (dev/staging/prod) и между сервисами |
| **Без шаблонов** | Запрещена генерация предсказуемых секретов (на основе дат, имён, шаблонов) |
| **Запрет ручного ввода** | Для критичных секретов — только автоматическая генерация инструментом (Vault, openssl) |

### 6.2. Распространение секретов

| Способ распространения | Допустимость | Описание |
|-----------------------|-------------|----------|
| **Vault / Secret Manager** | ✅ Рекомендуемый | Приложение / CI/CD запрашивает секрет из хранилища при запуске |
| **CI/CD переменные** | ✅ Допустимый | Секрет создаётся администратором в UI / API CI/CD системы (masked + protected) |
| **Зашифрованный файл (SOPS)** | ✅ Допустимый | Файл с секретами зашифрован и хранится в VCS; расшифровка при deployment |
| **Защищённый мессенджер** | ⚠️ Только для начальной передачи | Однократная передача секрета для первоначальной настройки (при отсутствии Vault) |
| **Email** | ❌ Запрещено | Email не является безопасным каналом для передачи секретов |
| **Чат (без шифрования)** | ❌ Запрещено | Незашифрованные чаты (Slack, Teams без E2E) не являются безопасным каналом |
| **Устно / на бумаге** | ❌ Запрещено | Невозможно контролировать, аудировать, ротировать |
| **Через код / VCS** | ❌ Запрещено | См. раздел 5 |

### 6.3. Процедура создания секрета

| Шаг | Действие | Ответственный |
|-----|----------|---------------|
| 1 | Определить тип, назначение и среду секрета | Запрашивающий (разработчик / DevOps) |
| 2 | Классифицировать по уровню критичности (раздел 3.1) | [ЗАПОЛНИТЬ: Security / владелец секрета] |
| 3 | Согласовать создание (для Critical/High — обязательно) | [ЗАПОЛНИТЬ: Security + владелец сервиса] |
| 4 | Сгенерировать секрет (CSPRNG, достаточная длина) | [ЗАПОЛНИТЬ: DevOps / Security / автоматически Vault] |
| 5 | Разместить секрет в системе управления секретами (Vault / CI/CD variables) | [ЗАПОЛНИТЬ: DevOps / Security] |
| 6 | Настроить доступ (RBAC — только необходимым сервисам/пользователям) | [ЗАПОЛНИТЬ: DevOps / Security] |
| 7 | Зарегистрировать в реестре секретов (раздел 10) | [ЗАПОЛНИТЬ: владелец секрета] |
| 8 | Установить дату следующей ротации | [ЗАПОЛНИТЬ: владелец секрета] |

---

## 7. Ротация секретов

### 7.1. Периодичность ротации

> Требование ГОСТ Р 56939-2024, п. 5.15.2 — ротировать секреты по регламенту.

| Тип секрета | Уровень | Периодичность ротации | Автоматизация |
|-------------|---------|----------------------|---------------|
| Production DB password | Critical | [ЗАПОЛНИТЬ: ≤ 90 дней] | [ЗАПОЛНИТЬ: Vault dynamic secrets / ручная] |
| TLS private key | Critical | [ЗАПОЛНИТЬ: при обновлении сертификата / ≤ 1 год] | [ЗАПОЛНИТЬ: cert-manager / Let's Encrypt auto-renewal] |
| Master encryption key | Critical | [ЗАПОЛНИТЬ: ≤ 1 год] | [ЗАПОЛНИТЬ: KMS key rotation / ручная] |
| Signing key (артефакты) | Critical | [ЗАПОЛНИТЬ: ≤ 1 год] | [ЗАПОЛНИТЬ: ручная с процедурой] |
| API-ключи production | High | [ЗАПОЛНИТЬ: ≤ 180 дней] | [ЗАПОЛНИТЬ: Vault / ручная] |
| CI/CD deploy credentials | High | [ЗАПОЛНИТЬ: ≤ 180 дней] | [ЗАПОЛНИТЬ: Vault dynamic secrets / CI/CD rotation] |
| OAuth2 client secret | High | [ЗАПОЛНИТЬ: ≤ 180 дней] | [ЗАПОЛНИТЬ: ручная] |
| Personal access tokens (VCS) | Medium | [ЗАПОЛНИТЬ: ≤ 90 дней] | [ЗАПОЛНИТЬ: автоматическое истечение] |
| SSH-ключи | Medium | [ЗАПОЛНИТЬ: ≤ 1 год] | [ЗАПОЛНИТЬ: ручная] |
| Webhook secrets | Medium | [ЗАПОЛНИТЬ: ≤ 365 дней] | [ЗАПОЛНИТЬ: ручная] |
| Development secrets | Low | По необходимости | — |

### 7.2. Процедура ротации

| Шаг | Действие | Ответственный |
|-----|----------|---------------|
| 1 | Получение уведомления о необходимости ротации (автоматическое напоминание или плановая дата) | Система управления секретами / владелец |
| 2 | Генерация нового секрета (CSPRNG) | [ЗАПОЛНИТЬ: DevOps / Security / Vault auto] |
| 3 | Размещение нового секрета в хранилище | [ЗАПОЛНИТЬ: DevOps / Security] |
| 4 | Обновление ссылок на секрет в приложениях/сервисах (graceful — поддержка обоих значений на переходный период) | [ЗАПОЛНИТЬ: DevOps / разработчик] |
| 5 | Верификация работоспособности с новым секретом | [ЗАПОЛНИТЬ: DevOps / QA] |
| 6 | Отзыв старого секрета (после подтверждения работоспособности) | [ЗАПОЛНИТЬ: DevOps / Security] |
| 7 | Обновление реестра секретов (новая дата создания, следующая дата ротации) | [ЗАПОЛНИТЬ: владелец секрета] |

### 7.3. Внеплановая ротация

Внеплановая ротация выполняется немедленно при:

| Событие | Действие |
|---------|----------|
| Подозрение на компрометацию секрета | Немедленная ротация + процедура реагирования (раздел 9) |
| Увольнение сотрудника, имевшего доступ к секретам | Ротация всех секретов, к которым имел доступ сотрудник |
| Обнаружение секрета в VCS / логах / артефактах | Немедленная ротация + очистка (раздел 9) |
| Обнаружение уязвимости в системе управления секретами | Ротация всех секретов, хранившихся в скомпрометированной системе |

### 7.4. Автоматизация ротации

| Метод | Описание | Применимость |
|-------|----------|-------------|
| **Vault Dynamic Secrets** | Vault генерирует short-lived credentials по запросу (напр., database credentials с TTL) | DB passwords, cloud credentials |
| **Vault Lease Renewal** | Автоматическое продление и ротация секретов по истечении lease | API tokens, DB credentials |
| **cert-manager** | Автоматическое обновление TLS-сертификатов (Let's Encrypt, внутренний CA) | TLS certificates |
| **CI/CD Token Expiration** | Автоматическое истечение access tokens по настроенному TTL | Personal access tokens, CI tokens |
| **Cron-задача** | Скрипт автоматической ротации по расписанию | [ЗАПОЛНИТЬ: при невозможности использования Vault] |

---

## 8. Контроль доступа к секретам

### 8.1. Принципы

> Требование ГОСТ Р 56939-2024, п. 5.15.2 — контролировать доступ к секретам.

| Принцип | Описание |
|---------|----------|
| **Минимальные привилегии** | Каждый пользователь и сервис имеют доступ только к тем секретам, которые необходимы для выполнения их функций |
| **Need-to-know** | Доступ к секрету предоставляется только при наличии обоснованной необходимости |
| **Разделение по средам** | Секреты development, staging и production хранятся раздельно; доступ к production-секретам — только у production-сервисов и ограниченного круга лиц |
| **Service-scoped** | Каждый микросервис / приложение имеет свой набор credentials; запрещено использование общих credentials |
| **Audit trail** | Все операции с секретами (чтение, создание, обновление, удаление) логируются |

### 8.2. Матрица доступа к секретам

| Роль | Создание секретов | Чтение секретов (production) | Чтение секретов (staging/dev) | Ротация | Удаление | Аудит |
|------|------------------|------------------------------|-------------------------------|---------|----------|-------|
| **Security Engineer** | ✅ | ✅ (Critical, High) | ✅ | ✅ | ✅ (с согласованием) | ✅ |
| **DevOps Engineer** | ✅ | ✅ (High, Medium — scoped) | ✅ | ✅ | ✅ (с согласованием) | ✅ |
| **Developer** | ❌ | ❌ | ✅ (свои сервисы) | ❌ | ❌ | ❌ |
| **Service Account** | ❌ | ✅ (только свои, scoped) | ✅ (только свои) | ❌ | ❌ | ❌ |
| **Auditor** | ❌ | ❌ (только метаданные) | ❌ (только метаданные) | ❌ | ❌ | ✅ |
| [ЗАПОЛНИТЬ: дополнительные] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |

### 8.3. Правила доступа

| Правило | Описание |
|---------|----------|
| Path-based access (Vault) | Секреты организованы по путям: `secret/data/{env}/{service}/{key}`; политики привязаны к путям |
| Environment isolation | Production-секреты недоступны из dev/staging-среды; CI/CD переменные помечены как protected (только для protected ветвей) |
| Time-limited access | Для ручного доступа к production-секретам — временный доступ (break glass) с обязательным аудитом |
| No plaintext export | Запрещён экспорт секретов в plaintext (CLI dump, API export); доступ только программный через API |
| Two-person rule | Для Critical-секретов — доступ или создание требует участия двух человек (dual authorization) |

---

## 9. Реагирование при компрометации секрета

### 9.1. Признаки компрометации

| Признак | Источник обнаружения |
|---------|---------------------|
| Секрет обнаружен в VCS (коммит, PR, история Git) | Secret scanning (GitLeaks, TruffleHog, GitHub Secret Scanning) |
| Секрет обнаружен в логах CI/CD или приложения | Мониторинг логов |
| Секрет обнаружен в артефакте сборки / контейнерном образе | Container scanning, manual review |
| Необъяснимая активность от service account | Мониторинг, аудит-журналы |
| Уведомление от внешнего сервиса (GitHub, облачный провайдер) | GitHub Secret Scanning partner alerts, AWS GuardDuty |
| Сообщение от сотрудника (случайная утечка) | Устное / письменное уведомление |

### 9.2. Процедура реагирования

| Шаг | Действие | Срок | Ответственный |
|-----|----------|------|---------------|
| 1 | **Обнаружение и уведомление** — зафиксировать факт компрометации, уведомить ответственных | Немедленно | Обнаруживший (автоматическая система или сотрудник) |
| 2 | **Отзыв секрета** — немедленно отозвать / деактивировать скомпрометированный секрет | [ЗАПОЛНИТЬ: ≤ 1 час для Critical; ≤ 4 часа для High] | [ЗАПОЛНИТЬ: DevOps + Security] |
| 3 | **Генерация нового секрета** — создать новый секрет и разместить в хранилище | Сразу после отзыва | [ЗАПОЛНИТЬ: DevOps / Security] |
| 4 | **Обновление сервисов** — обновить все сервисы, использующие секрет | Сразу после генерации | [ЗАПОЛНИТЬ: DevOps] |
| 5 | **Очистка из VCS** (если секрет был в коде) — удалить из истории Git (`git filter-branch` / BFG Repo-Cleaner); force push в affected ветки | [ЗАПОЛНИТЬ: ≤ 24 часа] | [ЗАПОЛНИТЬ: DevOps + Maintainer] |
| 6 | **Анализ воздействия** — определить, был ли секрет использован злоумышленником (анализ аудит-журналов, логов доступа) | [ЗАПОЛНИТЬ: ≤ 48 часов] | [ЗАПОЛНИТЬ: Security] |
| 7 | **Регистрация инцидента** — зарегистрировать как инцидент безопасности / недостаток по документу 04 (процесс 5.5) | Одновременно с шагом 2 | [ЗАПОЛНИТЬ: Security] |
| 8 | **Root cause analysis** — определить причину утечки (hardcoded в коде, утечка из логов, компрометация хранилища) | [ЗАПОЛНИТЬ: ≤ 5 рабочих дней] | [ЗАПОЛНИТЬ: Security + DevOps] |
| 9 | **Корректирующие меры** — усилить защиту для предотвращения повторения (добавить правила secret scanning, обновить pre-commit hooks, обучить команду) | По результатам RCA | [ЗАПОЛНИТЬ: Security + DevOps] |
| 10 | **Уведомление заинтересованных сторон** (при необходимости) — если компрометация затронула данные пользователей или внешние сервисы | По результатам анализа | [ЗАПОЛНИТЬ: руководитель РБПО, юристы] |

### 9.3. Очистка секрета из истории Git

> Удаление секрета из текущей версии файла **недостаточно** — секрет остаётся доступным в истории Git.

**Процедура:**

1. Определить все коммиты, содержащие секрет.
2. Использовать BFG Repo-Cleaner или `git filter-repo` для удаления секрета из истории.
3. Force push в затронутые ветки (с предупреждением команды).
4. Все разработчики выполняют `git fetch --all && git reset --hard origin/<branch>`.
5. Очистить кеши CI/CD, которые могут содержать старую историю.
6. Убедиться, что секрет удалён из всех fork-репозиториев (при наличии).

> **Важно:** Force push в protected ветки требует временного ослабления branch protection. Выполняется только CI/CD Administrator с согласованием Security.

---

## 10. Реестр секретов

### 10.1. Формат реестра

> Реестр содержит **метаданные** секретов, но **не сами секреты**.

| ID | Имя / Идентификатор | Тип | Назначение | Уровень критичности | Среда | Владелец | Хранилище | Дата создания | Дата последней ротации | Дата следующей ротации | Потребители (сервисы) | Статус |
|----|---------------------|-----|-----------|--------------------|----|----------|-----------|---------------|----------------------|----------------------|----------------------|--------|
| SEC-001 | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ: Password] | [ЗАПОЛНИТЬ: Production DB access] | [ЗАПОЛНИТЬ: Critical] | [ЗАПОЛНИТЬ: Production] | [ЗАПОЛНИТЬ: DBA] | [ЗАПОЛНИТЬ: Vault] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ: backend-service] | [ЗАПОЛНИТЬ: Active] |
| SEC-002 | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ: API Key] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |
| SEC-003 | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ: TLS Cert] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |

### 10.2. Статусы секретов

| Статус | Описание |
|--------|----------|
| **Active** | Секрет используется; срок ротации не истёк |
| **Pending Rotation** | Приближается или наступила дата ротации |
| **Rotating** | Ротация в процессе (новый секрет создан, старый ещё не отозван) |
| **Revoked** | Секрет отозван (по плану или из-за компрометации); не используется |
| **Compromised** | Секрет скомпрометирован; немедленно отозван; ведётся расследование |
| **Archived** | Секрет более не нужен; удалён из хранилища; запись сохранена для аудита |

### 10.3. Хранение и доступ к реестру

| Параметр | Значение |
|----------|----------|
| Место хранения реестра | [ЗАПОЛНИТЬ: Confluence (restricted) / внутренняя wiki / Vault metadata] |
| Доступ к реестру | [ЗАПОЛНИТЬ: Security Engineer, DevOps Engineer, аудиторы — read; Security — write] |
| Срок хранения записей | [ЗАПОЛНИТЬ: не менее 3 лет / срок действия сертификата + 1 год] |
| Синхронизация с Vault | [ЗАПОЛНИТЬ: автоматическая синхронизация метаданных / ручная актуализация] |

### 10.4. Напоминания о ротации

| Когда | Действие |
|-------|----------|
| [ЗАПОЛНИТЬ: 14 дней] до даты ротации | Автоматическое уведомление владельцу секрета |
| [ЗАПОЛНИТЬ: 7 дней] до даты ротации | Повторное уведомление + уведомление Security |
| Дата ротации наступила | Уведомление с пометкой Urgent; статус → Pending Rotation |
| [ЗАПОЛНИТЬ: 7 дней] после просрочки | Эскалация: уведомление руководителю РБПО |

---

## 11. История изменений

| Версия | Дата | Описание изменений | Автор |
|--------|------|--------------------|-------|
| 1.0 | [ЗАПОЛНИТЬ: дата] | Первая версия документа | [ЗАПОЛНИТЬ: ФИО] |
