# Регламент проверки цепочки поставок ПО

| | |
|---|---|
| **Продукт** | [ЗАПОЛНИТЬ: наименование СЗИ] |
| **Версия документа** | 1.0 |
| **Дата** | [ЗАПОЛНИТЬ: дата утверждения] |
| **Статус** | Проект |
| **Утверждено** | [ЗАПОЛНИТЬ: должность, ФИО руководителя] |
| **Процесс ГОСТ Р 56939-2024** | 5.17 — Проверка кода на внедрение вредоносного ПО через цепочки поставок |

---

## Содержание

1. [Общие сведения](#1-общие-сведения)
2. [Область применения](#2-область-применения)
3. [Перечень критических сторонних компонентов](#3-перечень-критических-сторонних-компонентов)
4. [Оценка рисков сторонних компонентов](#4-оценка-рисков-сторонних-компонентов)
5. [Проверка компонентов на вредоносные вставки](#5-проверка-компонентов-на-вредоносные-вставки)
6. [Контроль целостности зависимостей](#6-контроль-целостности-зависимостей)
7. [Защита от типовых supply chain атак](#7-защита-от-типовых-supply-chain-атак)
8. [Мониторинг supply chain угроз](#8-мониторинг-supply-chain-угроз)
9. [Интеграция с процессом SCA](#9-интеграция-с-процессом-sca)
10. [Реестр результатов проверок](#10-реестр-результатов-проверок)
11. [История изменений](#11-история-изменений)

---

## 1. Общие сведения

### 1.1. Назначение документа

Настоящий Регламент определяет порядок:

- Составления и актуализации перечня критических сторонних компонентов (библиотеки, базовые образы, инструменты сборки, SaaS-интеграции).
- Оценки рисков, связанных с использованием сторонних компонентов в продукте.
- Проверки заимствованных компонентов на наличие вредоносных вставок (backdoor, malware, обфусцированный код).
- Контроля целостности сторонних зависимостей (lock-файлы, контрольные суммы, подписи, SLSA provenance).
- Защиты от типовых supply chain атак (typosquatting, dependency confusion, compromised maintainer и др.).
- Мониторинга supply chain угроз и реагирования на инциденты в цепочке поставок.
- Интеграции проверок цепочки поставок с процессом композиционного анализа (SCA).

Регламент разработан в соответствии с требованиями ГОСТ Р 56939-2024, п. 5.17 (проверка кода на внедрение вредоносного ПО через цепочки поставок) и п. 5.17.2, которые устанавливают необходимость:

- Составить перечень критических элементов инфраструктуры от сторонних поставщиков.
- Проверять заимствованные компоненты на вредоносные вставки.
- Контролировать целостность сторонних зависимостей.
- Отслеживать supply chain атаки.

### 1.2. Нормативные ссылки

| Документ | Описание |
|----------|----------|
| ГОСТ Р 56939-2024, п. 5.17 | Проверка кода на внедрение вредоносного ПО через цепочки поставок — основной процесс |
| ГОСТ Р 56939-2024, п. 5.17.2 | Требования к процессу проверки цепочки поставок |
| ГОСТ Р 56939-2024, п. 5.16 | Композиционный анализ ПО — выявление известных уязвимостей в зависимостях |
| ГОСТ Р 56939-2024, п. 5.12 | Использование безопасной системы сборки ПО — целостность зависимостей при сборке |
| ГОСТ Р 56939-2024, п. 5.13 | Обеспечение безопасности сборочной среды — защита от poisoned dependencies в CI/CD |
| SLSA (Supply-chain Levels for Software Artifacts) | Фреймворк уровней безопасности цепочки поставок ПО; определяет требования к provenance артефактов |
| in-toto | Фреймворк для защиты целостности цепочки поставок — layout и link метаданные |
| Sigstore (cosign, Rekor, Fulcio) | Инструменты подписания, верификации и прозрачного логирования артефактов |
| OpenSSF Scorecard | Автоматизированная оценка безопасности open-source проектов |
| OSSF Package Analysis | Анализ поведения пакетов при установке |
| CWE-1357 | Reliance on Insufficiently Trustworthy Component |
| CWE-829 | Inclusion of Functionality from Untrusted Control Sphere |
| CWE-494 | Download of Code Without Integrity Check |

### 1.3. Связь с другими документами комплекта РБПО

| Документ РБПО | Связь |
|----------------|-------|
| 07 — Модель угроз | Supply chain атаки (внедрение вредоносного кода через зависимости, компрометация поставщика, подмена пакетов) являются частью модели угроз продукта (процесс 5.7) |
| 11 — Регламент безопасной сборки | Целостность зависимостей при сборке: lock-файлы, верификация хешей, воспроизводимые сборки обеспечивают защиту от подмены зависимостей на этапе сборки (процесс 5.12) |
| 12 — Регламент безопасности сборочной среды | Защита от poisoned dependencies в CI/CD: изоляция сборочной среды, контроль сетевого доступа runner предотвращают загрузку вредоносных пакетов (процесс 5.13) |
| 13 — Регламент управления доступом к коду | Контроль целостности заимствованного кода: подписание коммитов, branch protection и code review предотвращают несанкционированное внесение зависимостей (процесс 5.14) |
| 15 — Регламент композиционного анализа | SCA обнаруживает известные уязвимости (CVE) в зависимостях; настоящий регламент дополняет SCA проверками на вредоносность и supply chain integrity (процесс 5.16) |
| 04 — Регламент управления недостатками | Обнаруженные supply chain инциденты (вредоносный пакет, компрометация зависимости, нарушение целостности) регистрируются как недостатки безопасности (процесс 5.5) |

---

## 2. Область применения

### 2.1. Категории сторонних компонентов

Настоящий Регламент распространяется на следующие категории сторонних компонентов, используемых в продукте:

| Категория | Описание | Примеры |
|-----------|----------|---------|
| **Сторонние библиотеки и фреймворки** | Open-source и проприетарные пакеты, подключаемые как зависимости | npm-пакеты, PyPI-пакеты, Go modules, Maven artifacts, NuGet packages |
| **Базовые образы контейнеров** | Образы, на основе которых собираются контейнеры продукта | Alpine, Ubuntu, Debian, distroless, chainguard |
| **Инструменты сборки** | Компиляторы, build systems, пакетные менеджеры, CI/CD actions | gcc, node, npm, pip, uv, Docker, GitHub Actions, GitLab CI templates |
| **SaaS-интеграции** | Внешние сервисы, взаимодействующие с кодом или инфраструктурой | GitHub Apps, Dependabot, SonarCloud, Snyk, Codecov |
| **Плагины IDE** | Расширения IDE, имеющие доступ к исходному коду и среде разработки | VS Code extensions, IntelliJ plugins, vim plugins |
| **CI/CD компоненты** | Переиспользуемые actions, orbs, templates, shared runners | GitHub Actions (marketplace), GitLab CI templates, reusable workflows |
| **Шрифты, иконки, UI-ресурсы** | Внешние ресурсы, загружаемые при сборке или выполнении | CDN-ресурсы, npm-пакеты иконок, Google Fonts |

### 2.2. Исключения

| Категория | Причина исключения | Условие |
|-----------|-------------------|---------|
| Стандартные библиотеки ОС | Покрываются обновлениями ОС | Своевременное обновление ОС по регламенту |
| Внутренние библиотеки | Разработаны внутри организации и покрываются процессами РБПО | Соблюдение процессов 5.9 (code review), 5.10 (SAST) |
| [ЗАПОЛНИТЬ: дополнительные исключения] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |

### 2.3. Этапы жизненного цикла

Supply chain проверки выполняются на следующих этапах:

| Этап | Проверки | Периодичность |
|------|----------|---------------|
| **Добавление новой зависимости** | Полная проверка (разделы 4, 5, 6) | При каждом добавлении |
| **Обновление зависимости** | Diff-анализ, проверка целостности (разделы 5, 6) | При каждом обновлении |
| **CI/CD сборка** | Верификация lock-файлов, проверка checksums (раздел 6) | Каждая сборка |
| **Периодический аудит** | Полная переоценка рисков (раздел 4), мониторинг угроз (раздел 8) | [ЗАПОЛНИТЬ: ежемесячно / ежеквартально] |
| **Инцидент в экосистеме** | Экстренная проверка затронутых зависимостей | По факту инцидента |

---

## 3. Перечень критических сторонних компонентов

### 3.1. Реестр критических компонентов

> Требование ГОСТ Р 56939-2024, п. 5.17.2 — составить перечень критических элементов инфраструктуры от сторонних поставщиков.

| ID | Компонент | Категория | Поставщик / Источник | Текущая версия | Критичность | Частота проверок | Владелец | Дата последней проверки |
|----|-----------|-----------|---------------------|----------------|-------------|-----------------|----------|------------------------|
| SC-001 | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ: библиотека] | [ЗАПОЛНИТЬ: npm / PyPI / GitHub] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ: Critical / High / Medium / Low] | [ЗАПОЛНИТЬ: при обновлении / еженедельно] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |
| SC-002 | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ: базовый образ] | [ЗАПОЛНИТЬ: Docker Hub / Chainguard] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |
| SC-003 | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ: инструмент сборки] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |
| SC-004 | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ: SaaS-интеграция] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |
| SC-005 | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ: CI/CD action] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |

### 3.2. Критерии определения критичности

| Уровень | Описание | Примеры |
|---------|----------|---------|
| **Critical** | Компонент имеет прямой доступ к данным пользователей, криптографическим операциям, аутентификации или выполняется с повышенными привилегиями | Фреймворки аутентификации, криптографические библиотеки, ORM с доступом к БД, базовые образы production |
| **High** | Компонент обрабатывает пользовательский ввод, имеет сетевой доступ или влияет на целостность сборки | HTTP-клиенты, парсеры форматов, валидаторы, инструменты сборки, CI/CD actions с доступом к secrets |
| **Medium** | Компонент выполняет вспомогательные функции без прямого доступа к критичным данным | UI-библиотеки, утилиты форматирования, линтеры, инструменты тестирования |
| **Low** | Компонент используется только в dev-среде без влияния на production-артефакт | Dev-зависимости для форматирования кода, плагины IDE, генераторы документации |

### 3.3. Процедура актуализации реестра

| Событие | Действие |
|---------|----------|
| Добавление новой зависимости | Оценка критичности, внесение в реестр, назначение владельца |
| Удаление зависимости | Пометка записи как «Удалено» с датой и причиной |
| Смена поставщика / источника | Обновление записи, повторная оценка рисков |
| Мажорное обновление зависимости | Переоценка критичности |
| Плановый аудит | Ревизия всего реестра: [ЗАПОЛНИТЬ: ежеквартально] |

---

## 4. Оценка рисков сторонних компонентов

### 4.1. Критерии оценки

Для каждого стороннего компонента оцениваются следующие факторы риска:

| Критерий | Описание | Источники данных |
|----------|----------|-----------------|
| **Reputation (репутация)** | Известность проекта, количество пользователей, звёзды, загрузки, использование крупными проектами | GitHub stars, npm weekly downloads, PyPI stats, OpenSSF Scorecard |
| **Maintenance (поддержка)** | Активность разработки, частота релизов, время реакции на issues и security reports | GitHub activity, release frequency, issue response time |
| **Security history (история безопасности)** | Количество и критичность прошлых CVE, скорость выпуска патчей, наличие security policy | NVD, GitHub Advisory Database, OSV, SECURITY.md, security advisories |
| **Bus factor** | Количество активных maintainer'ов, зависимость от одного разработчика | GitHub contributors, commit distribution, CODEOWNERS |
| **Supply chain maturity** | Подписание релизов, SLSA provenance, transparency logs, build reproducibility | Sigstore verification, SLSA provenance, reproducible builds |
| **License compliance** | Совместимость лицензии с продуктом, наличие license changes в истории | SPDX, license scanners |
| **Transitive dependencies** | Количество и качество транзитивных зависимостей | npm audit, pip-audit, dependency tree analysis |

### 4.2. Скоринговая модель

| Критерий | Вес | Баллы (0–3) | Описание баллов |
|----------|-----|-------------|-----------------|
| Reputation | [ЗАПОЛНИТЬ: 15%] | 0 — неизвестен; 1 — мало пользователей; 2 — популярен; 3 — industry standard | Чем выше репутация, тем ниже риск |
| Maintenance | [ЗАПОЛНИТЬ: 20%] | 0 — abandoned (> 1 года без коммитов); 1 — редкие обновления; 2 — регулярные; 3 — активная разработка | Чем активнее поддержка, тем ниже риск |
| Security history | [ЗАПОЛНИТЬ: 25%] | 0 — критические CVE без патчей; 1 — частые CVE, медленные патчи; 2 — редкие CVE, быстрые патчи; 3 — чистая история или образцовая security practice | Чем лучше история, тем ниже риск |
| Bus factor | [ЗАПОЛНИТЬ: 15%] | 0 — единственный maintainer; 1 — 2–3 maintainer; 2 — организация / компания; 3 — foundation / крупное сообщество | Чем выше bus factor, тем ниже риск |
| Supply chain maturity | [ЗАПОЛНИТЬ: 15%] | 0 — без подписей, без provenance; 1 — checksums; 2 — подписи релизов; 3 — SLSA Level 3+, Sigstore, reproducible builds | Чем зрелее практики, тем ниже риск |
| Transitive dependencies | [ЗАПОЛНИТЬ: 10%] | 0 — > 100 транзитивных; 1 — 50–100; 2 — 10–50; 3 — < 10 или zero-dependency | Чем меньше зависимостей, тем ниже risk surface |

### 4.3. Допустимый уровень риска

| Итоговый балл (взвешенный) | Уровень риска | Действие |
|---------------------------|---------------|----------|
| [ЗАПОЛНИТЬ: ≥ 2.5] | **Низкий** | Допускается к использованию; стандартный мониторинг |
| [ЗАПОЛНИТЬ: 1.5–2.4] | **Средний** | Допускается с усиленным мониторингом; code review обновлений |
| [ЗАПОЛНИТЬ: 1.0–1.4] | **Высокий** | Требуется обоснование использования, согласование Security; sandbox-тестирование обновлений |
| [ЗАПОЛНИТЬ: < 1.0] | **Критический** | Запрещено к использованию; необходим поиск альтернативы или форк с внутренней поддержкой |

### 4.4. Процедура оценки

| Шаг | Действие | Ответственный |
|-----|----------|---------------|
| 1 | Разработчик инициирует добавление зависимости (PR с обоснованием) | Разработчик |
| 2 | Автоматический сбор метрик (OpenSSF Scorecard, npm audit, license check) | CI/CD pipeline |
| 3 | Ручная оценка по скоринговой модели (раздел 4.2) | [ЗАПОЛНИТЬ: Security / техлид] |
| 4 | Принятие решения на основе уровня риска (раздел 4.3) | [ЗАПОЛНИТЬ: Security + техлид] |
| 5 | Внесение в реестр критических компонентов (раздел 3) | [ЗАПОЛНИТЬ: владелец зависимости] |
| 6 | Периодическая переоценка по расписанию или при изменении факторов | [ЗАПОЛНИТЬ: Security] |

---

## 5. Проверка компонентов на вредоносные вставки

### 5.1. Методы проверки

> Требование ГОСТ Р 56939-2024, п. 5.17.2 — проверять заимствованные компоненты на вредоносные вставки.

| Метод | Описание | Когда применяется | Инструменты |
|-------|----------|-------------------|-------------|
| **Diff-анализ обновлений** | Построчное сравнение изменений между текущей и новой версией зависимости; выявление подозрительных вставок | При каждом обновлении зависимости | `npm diff`, `pip show --files`, `git diff`, [ЗАПОЛНИТЬ: Socket.dev / Phylum] |
| **Code review зависимостей** | Ручная проверка исходного кода критических зависимостей при добавлении или мажорном обновлении | При добавлении Critical/High зависимости; при мажорном обновлении | Ручной аудит, IDE, [ЗАПОЛНИТЬ: дополнительные] |
| **Behavioral analysis** | Анализ поведения пакета: сетевые обращения, доступ к файловой системе, выполнение произвольного кода при установке | При добавлении новых зависимостей; при подозрении на компрометацию | [ЗАПОЛНИТЬ: Socket.dev / Phylum / OSSF Package Analysis / Sandworm] |
| **Sandbox-тестирование** | Установка и запуск зависимости в изолированной среде (контейнер, VM) с мониторингом системных вызовов | Для High/Critical зависимостей; при обновлении с подозрительными изменениями | Docker, strace, [ЗАПОЛНИТЬ: gVisor / Firecracker / bubblewrap] |
| **Install-script анализ** | Проверка скриптов, выполняемых при установке пакета (preinstall, postinstall, setup.py) | При каждом добавлении зависимости | `npm pack --dry-run`, `--ignore-scripts`, ручной аудит setup.py / pyproject.toml |
| **Binary / obfuscation detection** | Обнаружение скомпилированных бинарных файлов и обфусцированного кода в пакете | При добавлении зависимости | [ЗАПОЛНИТЬ: Socket.dev / detect-secrets / custom scripts] |

### 5.2. Признаки вредоносных вставок

| Признак | Описание | Серьёзность |
|---------|----------|-------------|
| **Сетевые обращения при установке** | Пакет выполняет HTTP/DNS-запросы во время `npm install` / `pip install` | Critical |
| **Обфусцированный код** | Base64-кодирование, eval(), exec(), минификация без исходников | Critical |
| **Доступ к переменным окружения** | Чтение `process.env`, `os.environ` для извлечения секретов | Critical |
| **Доступ к файловой системе** | Чтение ~/.ssh, ~/.aws, ~/.npmrc, /etc/shadow | Critical |
| **Post-install скрипты** | Выполнение произвольного кода при установке (особенно в devDependencies) | High |
| **Неожиданный бинарный файл** | Скомпилированные .so, .dll, .exe, .wasm без исходного кода | High |
| **Зависимость от typosquatting-пакетов** | Транзитивные зависимости с именами, похожими на популярные пакеты | High |
| **Резкое изменение maintainer** | Смена владельца пакета без публичного объявления | Medium |
| **Необъяснимый рост размера** | Значительное увеличение размера пакета при минорном обновлении | Medium |

### 5.3. Процедура при обнаружении вредоносной вставки

| Шаг | Действие | Срок | Ответственный |
|-----|----------|------|---------------|
| 1 | Немедленно заблокировать использование скомпрометированного пакета (pin предыдущую safe-версию) | Немедленно | Обнаруживший / CI/CD автоматически |
| 2 | Уведомить ответственных (Security, техлид, DevOps) | [ЗАПОЛНИТЬ: ≤ 1 час] | Обнаруживший |
| 3 | Определить масштаб: в каких проектах / средах использовался пакет | [ЗАПОЛНИТЬ: ≤ 4 часа] | [ЗАПОЛНИТЬ: Security + DevOps] |
| 4 | Проверить, была ли скомпрометированная версия развёрнута в production | [ЗАПОЛНИТЬ: ≤ 4 часа] | [ЗАПОЛНИТЬ: DevOps] |
| 5 | Выполнить rollback или обновление на безопасную версию | [ЗАПОЛНИТЬ: ≤ 8 часов] | [ЗАПОЛНИТЬ: DevOps + разработчик] |
| 6 | Провести анализ потенциального воздействия (утечка secrets, данных) | [ЗАПОЛНИТЬ: ≤ 24 часа] | [ЗАПОЛНИТЬ: Security] |
| 7 | При необходимости — ротация скомпрометированных секретов (по документу 14) | По результатам анализа | [ЗАПОЛНИТЬ: Security + DevOps] |
| 8 | Зарегистрировать инцидент как недостаток (по документу 04, процесс 5.5) | Одновременно с шагом 2 | [ЗАПОЛНИТЬ: Security] |
| 9 | Сообщить в ecosystem security team (npm, PyPI) о вредоносном пакете | [ЗАПОЛНИТЬ: ≤ 24 часа] | [ЗАПОЛНИТЬ: Security] |
| 10 | Root cause analysis и корректирующие меры | [ЗАПОЛНИТЬ: ≤ 5 рабочих дней] | [ЗАПОЛНИТЬ: Security + техлид] |

---

## 6. Контроль целостности зависимостей

### 6.1. Lock-файлы

> Требование ГОСТ Р 56939-2024, п. 5.17.2 — контролировать целостность сторонних зависимостей.

| Правило | Описание |
|---------|----------|
| **Lock-файлы обязательны** | Каждый проект должен иметь lock-файл(ы), фиксирующие точные версии и хеш-суммы всех прямых и транзитивных зависимостей |
| **Lock-файлы в VCS** | Lock-файлы хранятся в системе контроля версий и являются элементами конфигурации |
| **Детерминированная установка** | В CI/CD используются команды детерминированной установки: `npm ci`, `pip install --require-hashes`, `uv pip install --strict` |
| **Review изменений lock-файла** | Изменения в lock-файлах проверяются при code review: неожиданные добавления/изменения зависимостей — повод для расследования |
| **Запрет на ручное редактирование** | Lock-файлы обновляются только через пакетный менеджер; ручное редактирование запрещено |

### 6.2. Реестр lock-файлов проекта

| Lock-файл | Пакетный менеджер | Расположение в репозитории | Поддержка хешей |
|-----------|-------------------|---------------------------|-----------------|
| [ЗАПОЛНИТЬ: package-lock.json] | npm | [ЗАПОЛНИТЬ: frontend/package-lock.json] | Да (integrity SHA-512) |
| [ЗАПОЛНИТЬ: requirements.txt (pinned)] | pip / uv | [ЗАПОЛНИТЬ: backends/python/requirements.txt] | [ЗАПОЛНИТЬ: Да / Нет — добавить --hash] |
| [ЗАПОЛНИТЬ: дополнительные] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |

### 6.3. Контрольные суммы (checksums)

| Уровень | Механизм | Описание |
|---------|----------|----------|
| **Package level** | Integrity hash в lock-файле | SHA-512 / SHA-256 хеш каждого пакета, фиксируется в lock-файле и проверяется при установке |
| **Registry level** | Registry checksums | npm registry и PyPI предоставляют checksums пакетов; верификация при скачивании |
| **Build artifact level** | SHA-256 артефакта | Контрольная сумма собранного артефакта (см. документ 11, раздел 7) |

### 6.4. Подписи пакетов и Sigstore/cosign

| Механизм | Описание | Поддержка | Статус использования |
|----------|----------|-----------|---------------------|
| **npm provenance** | npm Provenance Attestation — подтверждение, что пакет собран из определённого коммита в CI/CD | npm ≥ 9.5.0 | [ЗАПОЛНИТЬ: проверяется / не проверяется] |
| **Sigstore cosign** | Подписание и верификация контейнерных образов и артефактов | cosign ≥ 2.0 | [ЗАПОЛНИТЬ: используется / планируется] |
| **GPG-подписи** | Традиционная подпись пакетов (RPM, APT, Git tags) | Различная | [ЗАПОЛНИТЬ] |
| **PyPI Trusted Publishers** | Подтверждение, что пакет опубликован из доверенного CI/CD | PyPI + GitHub Actions | [ЗАПОЛНИТЬ] |
| **SLSA Provenance** | Attestation с информацией о сборке (builder, source, dependencies) | SLSA verifier | [ЗАПОЛНИТЬ] |

### 6.5. SLSA Provenance

| SLSA Level | Описание | Текущий уровень для продукта |
|------------|----------|------------------------------|
| Level 0 | Нет provenance | — |
| Level 1 | Документация о процессе сборки существует | [ЗАПОЛНИТЬ: достигнут / не достигнут] |
| Level 2 | Provenance генерируется hosted-сервисом (CI/CD); есть аутентичность | [ЗАПОЛНИТЬ] |
| Level 3 | Hardened builds — изолированная среда, non-falsifiable provenance | [ЗАПОЛНИТЬ] |
| Level 4 | Two-party review всех изменений, hermetic builds | [ЗАПОЛНИТЬ] |

**Целевой уровень SLSA:** [ЗАПОЛНИТЬ: Level 2 / Level 3]

### 6.6. Проверка целостности в CI/CD

| Проверка | Этап CI/CD | Инструмент | Действие при нарушении |
|----------|-----------|-----------|----------------------|
| Верификация lock-файла (нет drift) | Pre-build | `npm ci` (fails on mismatch), `pip install --require-hashes` | Блокировка сборки |
| Проверка integrity hashes | Install dependencies | Встроенный в пакетный менеджер | Блокировка сборки |
| Проверка подписей базовых образов | Docker build | cosign verify | Блокировка сборки |
| Проверка SLSA provenance (при доступности) | Pre-build | slsa-verifier | [ЗАПОЛНИТЬ: блокировка / предупреждение] |
| Обнаружение новых / изменённых зависимостей | PR check | [ЗАПОЛНИТЬ: custom script / Socket.dev] | Требуется review |

---

## 7. Защита от типовых supply chain атак

### 7.1. Типы атак и контрмеры

> Требование ГОСТ Р 56939-2024, п. 5.17.2 — отслеживать supply chain атаки.

| Тип атаки | Описание | Контрмеры | Инструменты |
|-----------|----------|-----------|-------------|
| **Typosquatting** | Публикация вредоносного пакета с именем, похожим на популярный (`lod-ash` вместо `lodash`, `colourama` вместо `colorama`) | Автоматическая проверка имён зависимостей на сходство с популярными пакетами; allow-list разрешённых пакетов; code review при добавлении зависимостей | [ЗАПОЛНИТЬ: Socket.dev / npm audit signatures / custom script] |
| **Dependency confusion** | Внутренний пакет подменяется вредоносным пакетом с тем же именем из публичного registry | Использование scope/namespace для внутренних пакетов (`@company/`); приоритет внутреннего registry; конфигурация `.npmrc` / `pip.conf` с ограничением sources | [ЗАПОЛНИТЬ: Artifactory / Nexus с routing rules / .npmrc scoped registry] |
| **Compromised maintainer** | Аккаунт maintainer'а скомпрометирован; злоумышленник публикует вредоносную версию | Мониторинг maintainer changes; подписание релизов (SLSA provenance); pinning зависимостей; diff-анализ обновлений | [ЗАПОЛНИТЬ: OpenSSF Scorecard / Socket.dev / npm provenance check] |
| **Malicious packages** | Публикация нового вредоносного пакета в public registry | Behavioral analysis при установке; allow-list зависимостей; запрет автоматического добавления неизвестных зависимостей | [ЗАПОЛНИТЬ: Socket.dev / Phylum / OSSF Package Analysis] |
| **Star-jacking** | Подделка популярности пакета (fake stars, fake downloads) для привлечения жертв | Проверка реальной активности (contributors, issues, commit history), а не только stars/downloads; использование OpenSSF Scorecard | Ручная проверка, OpenSSF Scorecard |
| **Protestware** | Maintainer внедряет деструктивный код в знак протеста (удаление файлов, вывод сообщений, geofencing) | Diff-анализ обновлений; sandbox-тестирование; мониторинг maintainer behaviour; pin версий | Diff-анализ, мониторинг |
| **CI/CD poisoning** | Вредоносные GitHub Actions / GitLab CI templates выполняют произвольный код в CI/CD среде | Pin actions по SHA (не по тегу); ограничение permissions actions; review third-party actions | [ЗАПОЛНИТЬ: StepSecurity / actionlint / allowed actions list] |
| **Compromised registry** | Компрометация самого package registry (npm, PyPI) | Зеркало / кеширующий proxy; верификация подписей пакетов; мониторинг аномалий | [ЗАПОЛНИТЬ: Artifactory / Nexus / Verdaccio] |

### 7.2. Allow-list зависимостей

| Правило | Описание |
|---------|----------|
| **Принцип** | Использование only approved dependencies — новая зависимость может быть добавлена только после прохождения оценки рисков (раздел 4) |
| **Реализация** | [ЗАПОЛНИТЬ: .github/allowed-dependencies.yml / Artifactory virtual repo / custom CI check] |
| **Обновление** | При добавлении новой зависимости — PR с обоснованием и результатами оценки |
| **Автоматизация** | CI/CD check блокирует PR, если зависимость не в allow-list |

### 7.3. Pinning стратегия

| Тип зависимости | Стратегия | Пример |
|-----------------|-----------|--------|
| **Production зависимости** | Exact pinning (точная версия) | `"lodash": "4.17.21"`, `lodash==4.17.21` |
| **Dev зависимости** | Exact pinning или caret range (с lock-файлом) | `"eslint": "^9.0.0"` + lock-файл |
| **Базовые Docker-образы** | Pin по digest (SHA-256) | `FROM node:20-alpine@sha256:abc123...` |
| **GitHub Actions** | Pin по commit SHA | `uses: actions/checkout@a5ac7e51b41094c92402da3b24376905380afc29` |
| **CI/CD templates** | Pin по тегу или SHA | [ЗАПОЛНИТЬ] |

---

## 8. Мониторинг supply chain угроз

### 8.1. Источники информации

| Источник | Описание | Тип информации | Способ подписки |
|----------|----------|---------------|-----------------|
| **NVD (National Vulnerability Database)** | Национальная база данных уязвимостей (США) | CVE для open-source компонентов | RSS / API |
| **GitHub Advisory Database** | База данных security advisories GitHub | CVE + GitHub-specific advisories | Dependabot alerts, API |
| **OSV (Open Source Vulnerabilities)** | Агрегатор уязвимостей open-source (Google) | CVE, GHSA, PyPA и другие source | API, osv-scanner |
| **npm Security Advisories** | Advisory для npm-пакетов | Уязвимости в npm-пакетах | `npm audit`, Dependabot |
| **PyPI Advisory Database** | Advisory для Python-пакетов | Уязвимости в PyPI-пакетах | pip-audit, Dependabot |
| **OpenSSF Package Analysis** | Анализ поведения новых пакетов в registry | Подозрительные пакеты, malware alerts | GitHub feed, API |
| **Socket.dev / Snyk / Phylum** | Коммерческие платформы мониторинга supply chain | Вредоносные пакеты, supply chain alerts | [ЗАПОЛНИТЬ: используется / не используется] |
| **Mailing lists / Blogs** | Публикации security-исследователей | Новые типы supply chain атак, инциденты | Подписка |

### 8.2. Автоматические подписки на advisory

| Экосистема | Инструмент | Частота проверки | Уведомления |
|-----------|-----------|------------------|-------------|
| npm | [ЗАПОЛНИТЬ: Dependabot / Renovate / npm audit CI] | [ЗАПОЛНИТЬ: ежедневно / при каждом push] | [ЗАПОЛНИТЬ: GitHub issues / email / Slack] |
| PyPI | [ЗАПОЛНИТЬ: Dependabot / pip-audit CI / Safety] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |
| Docker images | [ЗАПОЛНИТЬ: Trivy / Grype / Docker Scout] | [ЗАПОЛНИТЬ: ежедневно] | [ЗАПОЛНИТЬ] |
| GitHub Actions | [ЗАПОЛНИТЬ: StepSecurity / manual review] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |

### 8.3. Процедура реагирования на supply chain угрозу

| Приоритет | Описание | Срок реагирования | Действие |
|-----------|----------|-------------------|----------|
| **P0 — Active exploitation** | Вредоносный пакет обнаружен в production; активная эксплуатация | Немедленно | Экстренный rollback; блокировка пакета; ротация secrets; инцидент по документу 04 |
| **P1 — Confirmed malicious** | Зависимость подтверждена как вредоносная, но не развёрнута в production | [ЗАПОЛНИТЬ: ≤ 4 часа] | Блокировка обновления; pin безопасной версии; анализ exposure |
| **P2 — Suspected compromise** | Подозрение на компрометацию зависимости (необычные изменения, maintainer change) | [ЗАПОЛНИТЬ: ≤ 24 часа] | Приостановка обновления; diff-анализ; sandbox-тестирование |
| **P3 — Advisory published** | Опубликован security advisory (CVE) для зависимости | [ЗАПОЛНИТЬ: ≤ 72 часа] | Оценка воздействия; планирование обновления; передача в SCA процесс |

### 8.4. Дашборд мониторинга

| Метрика | Описание | Целевое значение |
|---------|----------|-----------------|
| Количество зависимостей с известными CVE | Число зависимостей с неустранёнными CVE (Critical/High) | [ЗАПОЛНИТЬ: 0 Critical, ≤ 3 High] |
| Средний возраст зависимостей | Среднее время с момента выхода последней версии используемых зависимостей | [ЗАПОЛНИТЬ: ≤ 6 месяцев] |
| Процент зависимостей с provenance | Доля зависимостей, имеющих SLSA provenance или подпись | [ЗАПОЛНИТЬ: ≥ 50% / растёт] |
| OpenSSF Scorecard средний балл | Средний Scorecard score для Critical/High зависимостей | [ЗАПОЛНИТЬ: ≥ 6.0/10] |
| Время реагирования на supply chain alert | Среднее время от получения alert до принятия мер | [ЗАПОЛНИТЬ: ≤ 24 часа] |

---

## 9. Интеграция с процессом SCA

### 9.1. Разграничение SCA и supply chain проверок

| Аспект | SCA (документ 15, процесс 5.16) | Supply chain (настоящий документ, процесс 5.17) |
|--------|--------------------------------|------------------------------------------------|
| **Фокус** | Известные уязвимости (CVE) в зависимостях | Вредоносность и целостность зависимостей |
| **Что обнаруживает** | CVE, устаревшие версии, лицензионные нарушения | Вредоносные вставки, typosquatting, compromised packages, нарушение целостности |
| **Источники данных** | NVD, GHSA, OSV, vendor advisories | Behavioral analysis, diff-анализ, provenance, Scorecard |
| **Инструменты** | npm audit, pip-audit, Trivy, Grype, Snyk | Socket.dev, Phylum, OSSF Package Analysis, cosign verify, slsa-verifier |
| **Этап CI/CD** | Post-install (сканирование зависимостей) | Pre-install (анализ пакета) + post-install (верификация) |

### 9.2. Дополнительные проверки поверх SCA

Supply chain регламент добавляет следующие проверки, которые не покрываются стандартным SCA:

| Проверка | Описание | Реализация |
|----------|----------|-----------|
| **Behavioral analysis** | Анализ поведения пакета при установке (network, filesystem, env access) | [ЗАПОЛНИТЬ: Socket.dev / custom sandbox] |
| **Provenance verification** | Проверка SLSA provenance и подписей пакетов | cosign verify, slsa-verifier, npm provenance |
| **Maintainer change detection** | Обнаружение смены maintainer'а пакета | [ЗАПОЛНИТЬ: Socket.dev / custom monitoring] |
| **Typosquatting detection** | Проверка имён зависимостей на сходство с популярными пакетами | [ЗАПОЛНИТЬ: custom CI check / Socket.dev] |
| **Dependency confusion check** | Проверка отсутствия конфликтов между internal и public пакетами | [ЗАПОЛНИТЬ: custom CI check / Artifactory routing] |
| **Install-script audit** | Анализ preinstall/postinstall скриптов | [ЗАПОЛНИТЬ: --ignore-scripts + manual review / Socket.dev] |
| **Allow-list enforcement** | Проверка, что все зависимости входят в approved list | [ЗАПОЛНИТЬ: custom CI check] |

### 9.3. Объединённый pipeline

| Этап | SCA проверка | Supply chain проверка | Порядок |
|------|-------------|----------------------|---------|
| PR opened | Scan for CVE (npm audit, pip-audit) | Check allow-list, typosquatting, new deps review | Параллельно |
| Install deps | — | Verify lock-file integrity, checksums | Перед установкой |
| Post-install | Vulnerability scan (Trivy, Grype) | Behavioral analysis (при наличии) | Параллельно |
| Docker build | Image scan for CVE | Verify base image signature, provenance | Последовательно |
| Pre-deploy | Final vulnerability gate | Final integrity gate | Последовательно |

---

## 10. Реестр результатов проверок

### 10.1. Формат реестра

| ID | Компонент | Версия | Тип проверки | Результат | Уровень риска | Обнаруженные проблемы | Принятые меры | Дата | Проверил |
|----|-----------|--------|-------------|-----------|---------------|----------------------|---------------|------|----------|
| SCC-001 | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ: оценка рисков / diff-анализ / behavioral / integrity] | [ЗАПОЛНИТЬ: Passed / Warning / Failed] | [ЗАПОЛНИТЬ: Low / Medium / High / Critical] | [ЗАПОЛНИТЬ: нет / описание] | [ЗАПОЛНИТЬ: допущено / заблокировано / обновлено] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |
| SCC-002 | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |
| SCC-003 | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] | [ЗАПОЛНИТЬ] |

### 10.2. Типы проверок

| Тип проверки | Код | Описание |
|-------------|-----|----------|
| Оценка рисков | RISK | Первичная или периодическая оценка по скоринговой модели (раздел 4) |
| Diff-анализ обновления | DIFF | Построчный анализ изменений при обновлении зависимости (раздел 5.1) |
| Behavioral analysis | BEHAV | Анализ поведения пакета при установке и выполнении (раздел 5.1) |
| Sandbox-тестирование | SAND | Установка и запуск в изолированной среде (раздел 5.1) |
| Проверка целостности | INTEG | Верификация checksums, подписей, SLSA provenance (раздел 6) |
| Code review зависимости | REVIEW | Ручной аудит исходного кода зависимости (раздел 5.1) |
| Реагирование на инцидент | INCIDENT | Экстренная проверка по факту supply chain инцидента (раздел 8.3) |

### 10.3. Результаты проверок

| Результат | Описание | Действие |
|-----------|----------|----------|
| **Passed** | Проверка пройдена успешно, проблем не обнаружено | Допускается к использованию |
| **Warning** | Обнаружены незначительные отклонения, требующие внимания | Допускается с усиленным мониторингом; необходима переоценка при следующем обновлении |
| **Failed** | Обнаружены серьёзные проблемы | Блокировка использования; поиск альтернативы или устранение проблемы |

### 10.4. Хранение и доступ к реестру

| Параметр | Значение |
|----------|----------|
| Место хранения реестра | [ЗАПОЛНИТЬ: Confluence (restricted) / внутренняя wiki / система управления зависимостями] |
| Доступ к реестру | [ЗАПОЛНИТЬ: Security Engineer, техлид, DevOps — read/write; разработчики — read] |
| Срок хранения записей | [ЗАПОЛНИТЬ: не менее 3 лет / срок действия сертификата + 1 год] |
| Автоматизация | [ЗАПОЛНИТЬ: CI/CD автоматически создаёт записи при каждой проверке / ручное ведение] |

---

## 11. История изменений

| Версия | Дата | Описание изменений | Автор |
|--------|------|--------------------|-------|
| 1.0 | [ЗАПОЛНИТЬ: дата] | Первая версия документа | [ЗАПОЛНИТЬ: ФИО] |
